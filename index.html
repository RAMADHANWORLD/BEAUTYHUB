<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noman Restaurant - Complete Management System</title>
    
    <!-- Embedded Leaflet CSS -->
    <style>
        /* Leaflet CSS (from https://unpkg.com/leaflet/dist/leaflet.css and https://unpkg.com/leaflet@1.7.1/dist/leaflet.css) */
        .leaflet-container {
            font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
        }
        .leaflet-pane,
        .leaflet-tile,
        .leaflet-marker-icon,
        .leaflet-marker-shadow,
        .leaflet-image-layer,
        .leaflet-tooltip,
        .leaflet-pane > canvas,
        .leaflet-pane > svg {
            left: 0;
            top: 0;
            position: absolute;
            opacity: 1;
            /* Force hardware acceleration here by default, if webkit-filter is supported */
            -webkit-transform: translate3d(0, 0, 0);
        }
        .leaflet-marker-icon,
        .leaflet-marker-shadow {
            display: block;
        }
        .leaflet-tile {
            filter: inherit;
            visibility: inherit;
        }
        .leaflet-zoom-box {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            z-index: 20000;
        }
        .leaflet-zoom-box.leaflet-zoom-in {
            border: 2px dotted #38f;
        }
        .leaflet-zoom-box.leaflet-zoom-out {
            border: 2px solid #38f;
        }
        /* Home page styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
        }

        /* Delivery Section */
        .customer_delivery-section {
            background: transparent;
            color: #333;
            padding: 15px 0;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            z-index: 100;
        }

        .customer_delivery-section.minimized {
            padding: 5px 0;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
        }

        .customer_delivery-section.minimized .customer_delivery-container {
            transform: scale(0.7);
        }

        .customer_delivery-section.minimized .customer_delivery-areas {
            display: none !important;
        }

        .customer_delivery-section.minimized .customer_delivery-text {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .customer_delivery-section.minimized .customer_option-button {
            padding: 6px 15px;
            font-size: 12px;
        }

        .customer_delivery-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .customer_delivery-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .customer_order-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .customer_option-button {
            background: #d32f2f;
            color: white;
            border: 2px solid #d32f2f;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .customer_option-button:hover {
            background: white;
            color: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .customer_option-button.selected {
            background: #ffeb3b;
            color: #d32f2f;
            border-color: #ffeb3b;
            box-shadow: 0 4px 12px rgba(255, 235, 59, 0.3);
        }

        .customer_delivery-areas {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: rgba(211, 47, 47, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(211, 47, 47, 0.2);
        }

        .customer_delivery-areas.show {
            display: block;
        }

        .customer_areas-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .customer_areas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .customer_area-item {
            background: rgba(211, 47, 47, 0.1);
            border: 1px solid rgba(211, 47, 47, 0.3);
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .customer_area-item:hover {
            background: rgba(211, 47, 47, 0.2);
            transform: translateY(-2px);
        }

        .customer_area-item.selected {
            background: #ffeb3b;
            color: #d32f2f;
            font-weight: bold;
        }

        .customer_phone-highlight {
            background: #ffeb3b;
            color: #d32f2f;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            display: inline-block;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(255, 235, 59, 0.3);
        }

        /* Mobile Responsive for Delivery Section */
        @media (max-width: 768px) {
            .customer_delivery-text {
                font-size: 16px;
            }

            .customer_order-options {
                gap: 15px;
            }

            .customer_option-button {
                padding: 10px 20px;
                font-size: 13px;
            }

            .customer_areas-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .customer_phone-highlight {
                font-size: 15px;
                padding: 8px 15px;
            }
        }

        /* Categories Section */
        .customer_categories-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .customer_category-section {
            margin-bottom: 30px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .customer_category-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .customer_category-banner {
            width: 100%;
            height: 250px;
            position: relative;
            overflow: hidden;
        }

        .customer_category-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .customer_category-section:hover .customer_category-image {
            transform: scale(1.05);
        }

        /* Text-only category sections */
        .customer_category-text-section {
            margin-bottom: 30px;
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .customer_category-text-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .customer_category-text-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" patternUnits="userSpaceOnUse" width="100" height="100"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.03)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }

        .customer_category-title {
            color: white;
            font-size: 48px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1;
        }

        /* Mobile Responsive for Categories */
        @media (max-width: 768px) {
            .customer_categories-section {
                padding: 15px;
            }

            .customer_category-banner {
                height: 200px;
            }

            .customer_category-section {
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            .customer_categories-section {
                padding: 10px;
            }

            .customer_category-banner {
                height: 180px;
            }
        }

        /* Header Banner Section */
        .customer_header-banner {
            width: 100%;
            height: 300px;
            background-image: url('https://assets.brenqo.io/cdn-cgi/image/width=1200,quality=90,format=webp/https://console.brenqo.io/upload/1746705493-noman_banner_new.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        /* Navigation Menu */
        .customer_navigation-menu {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .customer_nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .customer_nav-menu {
            display: flex;
            list-style: none;
            align-items: center;
            min-height: 60px;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
        }

        .customer_nav-item {
            flex-shrink: 0;
        }

        .customer_nav-link {
            display: block;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            position: relative;
            border-radius: 8px;
            margin: 2px;
        }

        .customer_nav-link:hover {
            color: #d32f2f;
            border-bottom-color: #d32f2f;
            background: rgba(211, 47, 47, 0.05);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .customer_header-banner {
                height: 250px;
            }

            .customer_nav-container {
                padding: 0 10px;
            }

            .customer_nav-link {
                padding: 12px 15px;
                font-size: 12px;
            }

            .customer_nav-menu {
                gap: 3px;
            }
        }

        @media (max-width: 480px) {
            .customer_header-banner {
                height: 200px;
            }

            .customer_nav-link {
                padding: 10px 12px;
                font-size: 11px;
            }

            .customer_nav-menu {
                gap: 2px;
            }
        }
        /* Admin (60) styles */
        .admin_section.active {
            display: block;
        }
        .admin_modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .admin_modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin_modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .admin_close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        .admin_alert {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }

        .admin_alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .admin_alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .admin_loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .admin_section {
            display: none;
        }

        .admin_section.active {
            display: block;
        }
        .admin_map-container {
            height: 400px;
            background: #f0f0f0;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 2px solid #ddd;
        }
        .admin_toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .admin_toast.show {
            transform: translateX(0);
        }

        .admin_toast-success {
            border-left: 4px solid #28a745;
        }

        .admin_toast-error {
            border-left: 4px solid #dc3545;
        }
        /* Admin styles */
        html.body_all {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        .admin_header {
            background: linear-gradient(135deg, #d32f2f 0%, #ff5722 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin_container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .admin_header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin_logo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .admin_nav-links {
            display: flex;
            gap: 1rem;
        }

        .admin_nav-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid white;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .admin_nav-btn:hover, .admin_nav-btn.active {
            background: white;
            color: #d32f2f;
        }

        .admin_main-content {
            padding: 2rem 0;
        }

        .admin_dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .admin_stats-panel, .admin_form-panel, .admin_products-panel {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin_panel-title {
            font-size: 1.5rem;
            color: #d32f2f;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 0.5rem;
        }

        .admin_stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .admin_stat-label {
            font-weight: 500;
            color: #666;
        }

        .admin_stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d32f2f;
        }

        .admin_form-group {
            margin-bottom: 1rem;
        }

        .admin_form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .admin_form-input, .admin_form-select, .admin_form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .admin_form-input:focus, .admin_form-select:focus, .admin_form-textarea:focus {
            outline: none;
            border-color: #d32f2f;
        }

        .admin_form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .admin_btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .admin_btn-primary {
            background: #d32f2f;
            color: white;
        }

        .admin_btn-primary:hover {
            background: #b71c1c;
        }

        .admin_btn-secondary {
            background: #666;
            color: white;
        }

        .admin_btn-secondary:hover {
            background: #555;
        }

        .admin_btn-danger {
            background: #f44336;
            color: white;
        }

        .admin_btn-danger:hover {
            background: #d32f2f;
        }

        .admin_btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .admin_products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .admin_products-table th,
        .admin_products-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .admin_products-table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }

        .admin_products-table tr:hover {
            background: #f9f9f9;
        }

        .admin_product-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
        }

        .admin_image-placeholder {
            width: 50px;
            height: 50px;
            background: #f5f5f5;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 0.8rem;
            border: 2px dashed #ddd;
        }

        .admin_actions {
            display: flex;
            gap: 0.5rem;
        }

        .admin_rider-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin_rider-info {
            flex: 1;
        }

        .admin_rider-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .admin_rider-details {
            color: #666;
            font-size: 0.9rem;
        }

        .admin_rider-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .admin_status-available {
            background: #d4edda;
            color: #155724;
        }

        .admin_status-busy {
            background: #fff3cd;
            color: #856404;
        }

        .admin_status-offline {
            background: #f8d7da;
            color: #721c24;
        }

        .admin_order-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin_order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .admin_order-id {
            font-weight: bold;
            color: #d32f2f;
        }

        .admin_order-status {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .admin_status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .admin_status-assigned {
            background: #cce5ff;
            color: #004085;
        }

        .admin_status-picked {
            background: #d4edda;
            color: #155724;
        }

        .admin_status-delivered {
            background: #d1ecf1;
            color: #0c5460;
        }

        .admin_status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .admin_status-confirmed {
            background: #cff4fc;
            color: #055160;
        }

        .admin_currency {
            font-weight: bold;
            color: #d32f2f;
        }

        @media (max-width: 768px) {
            .admin_dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .admin_nav-links {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .admin_header-content {
                flex-direction: column;
                gap: 1rem;
            }
        }

        .admin_stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .admin_stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .admin_stat-card h3 {
            color: #d32f2f;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .admin_stat-card p {
            color: #666;
            font-weight: 500;
        }

        /* Rider (99) styles */
        body {
            font-family: 'Arial', sans-serif;
            background: #f8fafc;
            color: #334155;
            min-height: 100vh;
        }

        /* Navigation (Main) */
        .main_nav-container {
            background: linear-gradient(135deg, #d32f2f 0%, #ff5722 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .main_logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .main_logo-img {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 50%;
            padding: 4px;
        }

        .main_logo-text h1 {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .main_nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .main_nav-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .main_nav-btn:hover, .main_nav-btn.active {
            background: white;
            color: #d32f2f;
        }

        /* Page Containers */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Admin Panel Styles (from index 99.html - mostly discarded but some base styles needed) */
        /* .rider_stats-grid {} */
        /* .rider_stat-card {} */
        /* ... many rider_admin styles are removed */

        /* Rider App Styles */
        .riderApp_rider-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: calc(100vh - 100px);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .riderApp_rider-content {
            padding: 2rem;
        }

        .riderApp_form-group {
            margin-bottom: 1.5rem;
        }

        .riderApp_form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .riderApp_form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .riderApp_form-input:focus {
            outline: none;
            border-color: #d32f2f;
            background: white;
            box-shadow: 0 0 10px rgba(211, 47, 47, 0.1);
        }

        .riderApp_btn-rider {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .riderApp_btn-rider.primary {
            background: linear-gradient(135deg, #d32f2f 0%, #ff5722 100%);
            color: white;
        }

        .riderApp_btn-rider.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .riderApp_btn-rider.danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .riderApp_btn-rider:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .riderApp_rider-status-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #d32f2f;
        }

        .riderApp_status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .riderApp_status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
        }

        .riderApp_status-dot.online {
            background: #28a745;
        }

        .riderApp_coordinates {
            font-family: monospace;
            font-size: 0.9rem;
            color: #666;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 5px;
            margin-top: 0.5rem;
        }

        .riderApp_alert {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }

        .riderApp_alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .riderApp_alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .riderApp_loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .riderApp_loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #d32f2f;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .page-container {
                padding: 1rem;
            }
            
            .main_nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            .main_nav-buttons {
                width: 100%;
                justify-content: center;
            }
        }
        /* Styles from new rider.html */
        /* Using a "newrider_" prefix for unique IDs and styles from the new rider.html */
        .newrider_admin-page { display: none; }
        .newrider_admin-page.active { display: block; }
        .newrider_rider-page { display: none; }
        .newrider_rider-page.active { display: block; }

        .newrider_container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .newrider_stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .newrider_stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 4px solid #d32f2f;
        }
        .newrider_stat-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .newrider_stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }
        .newrider_stat-icon.primary { background: linear-gradient(135deg, #d32f2f 0%, #ff5722 100%); }
        .newrider_stat-icon.success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .newrider_stat-icon.warning { background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%); }
        .newrider_stat-icon.gray { background: #6c757d; }
        .newrider_stat-info h3 {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .newrider_stat-info p {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
        }
        .newrider_main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .newrider_section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .newrider_section-header {
            background: linear-gradient(135deg, #d32f2f 0%, #ff5722 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .newrider_section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }
        .newrider_btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        .newrider_btn-primary { background: #d32f2f; color: white; }
        .newrider_btn-primary:hover { background: #b71c1c; }
        .newrider_btn-success { background: #28a745; color: white; }
        .newrider_btn-success:hover { background: #1e7e34; }
        .newrider_btn-secondary {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
        }
        .newrider_btn-secondary:hover { background: rgba(255,255,255,0.3); }
        #newrider_admin_map {
            width: 100%;
            height: 400px;
        }
        .newrider_map-info {
            padding: 1rem;
            text-align: center;
            font-size: 0.875rem;
            color: #64748b;
            background: #f8fafc;
        }
        .newrider_riders-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
        }
        .newrider_rider-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #d32f2f;
        }
        .newrider_rider-card.online { border-left-color: #28a745; }
        .newrider_rider-card.busy { border-left-color: #ffc107; }
        .newrider_rider-card.offline { border-left-color: #6c757d; }
        .newrider_rider-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .newrider_rider-info h4 {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }
        .newrider_rider-info p {
            font-size: 0.875rem;
            color: #64748b;
        }
        .newrider_status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .newrider_status-badge.online { background: #dcfce7; color: #166534; }
        .newrider_status-badge.busy { background: #fef3c7; color: #92400e; }
        .newrider_status-badge.offline { background: #f1f5f9; color: #475569; }

        /* New Rider App Styles (prefixed for uniqueness) */
        .newrider_rider-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: calc(100vh - 100px);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .newrider_rider-content { padding: 2rem; }
        .newrider_form-group { margin-bottom: 1.5rem; }
        .newrider_form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        .newrider_form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        .newrider_form-input:focus {
            outline: none;
            border-color: #d32f2f;
            background: white;
            box-shadow: 0 0 10px rgba(211, 47, 47, 0.1);
        }
        .newrider_btn-rider {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .newrider_btn-rider.primary {
            background: linear-gradient(135deg, #d32f2f 0%, #ff5722 100%);
            color: white;
        }
        .newrider_btn-rider.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        .newrider_btn-rider.danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }
        .newrider_btn-rider:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .newrider_rider-status-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #d32f2f;
        }
        .newrider_status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .newrider_status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
        }
        .newrider_status-dot.online { background: #28a745; }
        .newrider_coordinates {
            font-family: monospace;
            font-size: 0.9rem;
            color: #666;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 5px;
            margin-top: 0.5rem;
        }
        .newrider_alert {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }
        .newrider_alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .newrider_alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .newrider_loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        .newrider_loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #d32f2f;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        .newrider_add-rider-form {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .newrider_form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        @media (max-width: 768px) {
            .newrider_container { padding: 1rem; }
            .newrider_main-content { grid-template-columns: 1fr; }
            .newrider_stats-grid { grid-template-columns: repeat(2, 1fr); }
            #newrider_admin_map { height: 300px; }
        }
    </style>
</head>
<body class="body_all">
    <!-- Main Navigation -->
    <nav class="main_nav-container">
        <div class="main_logo-section">
            <img src="https://assets.brenqo.io/cdn-cgi/image/width=300,quality=100,format=webp/https://console.brenqo.io/upload/1746705509-noman_logo_new.png" 
                 alt="Noman Restaurant" class="main_logo-img">
            <div class="main_logo-text">
                <h1>🍽️ Noman Restaurant</h1>
                <p>Complete Management System</p>
            </div>
        </div>
        <div class="main_nav-buttons">
            <button class="main_nav-btn active" onclick="main_showPage('customer')">Customer View</button>
            <button class="main_nav-btn" onclick="main_showPage('admin')">Admin Panel (IndexedDB)</button>
            <button class="main_nav-btn" onclick="main_showPage('rider')">Rider App (IndexedDB)</button>
            <button class="main_nav-btn" onclick="main_showPage('newrider_admin')">Admin Panel (Supabase)</button>
            <button class="main_nav-btn" onclick="main_showPage('newrider_rider')">Rider App (Supabase)</button>
        </div>
    </nav>

    <!-- Customer View Page (from index_updated.html) -->
    <div id="customer-view-container" class="page-content active">
        <!-- Delivery Section -->
        <div class="customer_delivery-section">
            <div class="customer_delivery-container">
                <div class="customer_delivery-text">Delivery to</div>
                
                <div class="customer_order-options">
                    <button class="customer_option-button" onclick="customer_selectOption('pickup', event)">Pickup</button>
                    <button class="customer_option-button" onclick="customer_selectOption('delivery', event)">Delivery</button>
                </div>
                
                <div class="customer_delivery-areas" id="customer_deliveryAreas">
                    <div class="customer_areas-title">Select Your Area:</div>
                    <div class="customer_areas-grid">
                        <div class="customer_area-item" onclick="customer_selectArea('PNT Darrusalam Society', event)">PNT Darrusalam Society</div>
                        <div class="customer_area-item" onclick="customer_selectArea('KDA', event)">KDA</div>
                        <div class="customer_area-item" onclick="customer_selectArea('Lacknow Society', event)">Lacknow Society</div>
                        <div class="customer_area-item" onclick="customer_selectArea('Zia Colony', event)">Zia Colony</div>
                    </div>
                    <div class="customer_phone-highlight">📞 0317-2840527</div>
                </div>
            </div>
        </div>

        <!-- Header Banner -->
        <div class="customer_header-banner">
        </div>

        <!-- Navigation Menu -->
        <nav class="customer_navigation-menu">
            <div class="customer_nav-container">
                <ul class="customer_nav-menu">
                    <li class="customer_nav-item"><a href="#customer_pizza" class="customer_nav-link">Pizza</a></li>
                    <li class="customer_nav-item"><a href="#customer_chinese" class="customer_nav-link">Chinese</a></li>
                    <li class="customer_nav-item"><a href="#customer_rice" class="customer_nav-link">Rice</a></li>
                    <li class="customer_nav-item"><a href="#customer_burger" class="customer_nav-link">Burger</a></li>
                    <li class="customer_nav-item"><a href="#customer_broast" class="customer_nav-link">Broast</a></li>
                    <li class="customer_nav-item"><a href="#customer_sandwiches" class="customer_nav-link">Sandwiches</a></li>
                    <li class="customer_nav-item"><a href="#customer_bbq" class="customer_nav-link">BBQ</a></li>
                    <li class="customer_nav-item"><a href="#customer_karahi" class="customer_nav-link">Karahi</a></li>
                    <li class="customer_nav-item"><a href="#customer_handi" class="customer_nav-link">Handi</a></li>
                    <li class="customer_nav-item"><a href="#customer_salan" class="customer_nav-link">Salan</a></li>
                    <li class="customer_nav-item"><a href="#customer_roll" class="customer_nav-link">Roll</a></li>
                    <li class="customer_nav-item"><a href="#customer_fries" class="customer_nav-link">Fries</a></li>
                    <li class="customer_nav-item"><a href="#customer_sweets" class="customer_nav-link">Sweets</a></li>
                    <li class="customer_nav-item"><a href="#customer_sides" class="customer_nav-link">Sides</a></li>
                    <li class="customer_nav-item"><a href="#customer_beverages" class="customer_nav-link">Beverages</a></li>
                    <li class="customer_nav-item"><a href="#customer_fish" class="customer_nav-link">Fish</a></li>
                </ul>
            </div>
        </nav>

        <!-- Food Categories Section -->
        <div class="customer_categories-section">
            <!-- Pizza Category -->
            <div class="customer_category-section" id="customer_pizza">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746708043-pizza.jpg" alt="Pizza" class="customer_category-image">
                </div>
            </div>

            <!-- Chinese Category -->
            <div class="customer_category-section" id="customer_chinese">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707959-Chinese.jpg" alt="Chinese" class="customer_category-image">
                </div>
            </div>

            <!-- Rice Category -->
            <div class="customer_category-section" id="customer_rice">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746708003-Rice.jpg" alt="Rice" class="customer_category-image">
                </div>
            </div>

            <!-- Burger Category -->
            <div class="customer_category-section" id="customer_burger">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707998-Burger.jpg" alt="Burger" class="customer_category-image">
                </div>
            </div>

            <!-- Broast Category -->
            <div class="customer_category-section" id="customer_broast">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707992-Broast.jpg" alt="Broast" class="customer_category-image">
                </div>
            </div>

            <!-- Sandwiches Category -->
            <div class="customer_category-section" id="customer_sandwiches">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707984-Sandwiches.jpg" alt="Sandwiches" class="customer_category-image">
                </div>
            </div>

            <!-- BBQ Category -->
            <div class="customer_category-section" id="customer_bbq">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707965-BBQ.jpg" alt="BBQ" class="customer_category-image">
                </div>
            </div>

            <!-- Karahi Category -->
            <div class="customer_category-section" id="customer_karahi">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1755449649-karahi.jpg" alt="Karahi" class="customer_category-image">
                </div>
            </div>

            
            <!-- Handi Category -->
            <div class="customer_category-section" id="customer_handi">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707950-Handi.jpg" alt="Handi" class="customer_category-image">
                </div>
            </div>
        
            
            <!-- Salan Category -->
            <div class="customer_category-section" id="customer_salan">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707978-Salan.jpg" alt="Salan" class="customer_category-image">
                </div>
            </div>
        
            
            <!-- Roll Category -->
            <div class="customer_category-section" id="customer_roll">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707973-Roll.jpg" alt="Roll" class="customer_category-image">
                </div>
            </div>
        
            
            <!-- Fries Category -->
            <div class="customer_category-section" id="customer_fries">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707969-Fries.jpg" alt="Fries" class="customer_category-image">
                </div>
            </div>
        
            
            <!-- Sweets Category -->
            <div class="customer_category-section" id="customer_sweets">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707945-Sweets.jpg" alt="Sweets" class="customer_category-image">
                </div>
            </div>
        
            
            <!-- Sides Category -->
            <div class="customer_category-section" id="customer_sides">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707940-Sides.jpg" alt="Sides" class="customer_category-image">
                </div>
            </div>
        
            
            <!-- Beverages Category -->
            <div class="customer_category-section" id="customer_beverages">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707934-Beverages.jpg" alt="Beverages" class="customer_category-image">
                </div>
            </div>
        
            <!-- Fish Category -->
            <div class="customer_category-section" id="customer_fish">
                <div class="customer_category-banner">
                    <img src="https://assets.brenqo.io/cdn-cgi/image/width=800,quality=70,format=webp/https://console.brenqo.io/upload/1746707928-Fish.jpg" alt="Fish" class="customer_category-image">
                </div>
            </div>

        </div>
    </div>

    <!-- Admin Panel Page (from admin (60).html) -->
    <div id="admin-view-container" class="page-content">
        <header class="admin_header">
            <div class="admin_container">
                <div class="admin_header-content">
                    <div class="admin_logo">Noman Restaurant Admin</div>
                    <nav class="admin_nav-links">
                        <button class="admin_nav-btn active" data-section="admin_dashboard">Dashboard</button>
                        <button class="admin_nav-btn" data-section="admin_orders">Orders</button>
                        <button class="admin_nav-btn" data-section="admin_products">Products</button>
                        <button class="admin_nav-btn" data-section="admin_riders">Riders</button>
                        <button class="admin_nav-btn" data-section="admin_customers">Customers</button>
                        <button class="admin_nav-btn" data-section="admin_analytics">Analytics</button>
                    </nav>
                </div>
            </div>
        </header>

        <main class="admin_main-content">
            <div class="admin_container">
                <!-- Dashboard Section -->
                <section id="admin_dashboard" class="admin_section active">
                    <div class="admin_stats-grid">
                        <div class="admin_stat-card">
                            <h3 id="admin_total-orders">0</h3>
                            <p>Total Orders Today</p>
                        </div>
                        <div class="admin_stat-card">
                            <h3><span class="admin_currency">PKR</span> <span id="admin_total-revenue">0</span></h3>
                            <p>Today's Revenue</p>
                        </div>
                        <div class="admin_stat-card">
                            <h3 id="admin_active-riders">0</h3>
                            <p>Active Riders</p>
                        </div>
                        <div class="admin_stat-card">
                            <h3 id="admin_pending-orders">0</h3>
                            <p>Pending Orders</p>
                        </div>
                    </div>

                    <div class="admin_dashboard-grid">
                        <div class="admin_stats-panel">
                            <h2 class="admin_panel-title">Quick Stats</h2>
                            <div class="admin_stat-item">
                                <span class="admin_stat-label">Average Order Value</span>
                                <span class="admin_stat-value"><span class="admin_currency">PKR</span> <span id="admin_avg-order">0</span></span>
                            </div>
                            <div class="admin_stat-item">
                                <span class="admin_stat-label">Delivery Time (Avg)</span>
                                <span class="admin_stat-value"><span id="admin_avg-delivery">0</span> min</span>
                            </div>
                            <div class="admin_stat-item">
                                <span class="admin_stat-label">Customer Satisfaction</span>
                                <span class="admin_stat-value"><span id="admin_satisfaction">0</span>/5</span>
                            </div>
                            <div class="admin_stat-item">
                                <span class="admin_stat-label">Popular Item</span>
                            <span class="admin_stat-value" id="admin_popular-item">N/A</span>
                            </div>
                        </div>

                        <div class="admin_form-panel">
                            <h2 class="admin_panel-title">Quick Actions</h2>
                            <div style="display: grid; gap: 1rem;">
                                <button class="admin_btn admin_btn-primary" onclick="admin_addNewProduct()">Add New Product</button>
                                <button class="admin_btn admin_btn-primary" onclick="admin_addNewRider()">Add New Rider</button>
                                <button class="admin_btn admin_btn-secondary" onclick="admin_generateReport()">Generate Daily Report</button>
                                <button class="admin_btn admin_btn-secondary" onclick="admin_exportData()">Export Data</button>
                            </div>
                        </div>
                    </div>

                    <div class="admin_map-container" id="admin_map-container">
                        <div id="admin_dashboard_map" style="height: 100%; width: 100%;"></div>
                    </div>
                </section>

                <!-- Orders Section -->
                <section id="admin_orders" class="admin_section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 class="admin_panel-title">Orders Management</h2>
                        <button class="admin_btn admin_btn-primary" onclick="admin_refreshOrders()">Refresh Orders</button>
                    </div>

                    <div id="admin_orders-container">
                        <!-- Orders will be loaded here -->
                    </div>
                </section>

                <!-- Products Section -->
                <section id="admin_products" class="admin_section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 class="admin_panel-title">Products Management</h2>
                        <button class="admin_btn admin_btn-primary" onclick="admin_addNewProduct()">Add New Product</button>
                    </div>

                    <div class="admin_products-panel">
                        <table class="admin_products-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Price (PKR)</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin_products-table-body">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Riders Section -->
                <section id="admin_riders" class="admin_section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 class="admin_panel-title">Riders Management</h2>
                        <button class="admin_btn admin_btn-primary" onclick="admin_addNewRider()">Add New Rider</button>
                    </div>

                    <div id="admin_riders-container">
                        <!-- Riders will be loaded here -->
                    </div>
                    
                    <div class="admin_products-panel" style="margin-top: 2rem;">
                        <h3 class="admin_panel-title">Live Rider Tracking</h3>
                        <div class="admin_map-container" id="admin_riders-map-container">
                            <div id="admin_riders_map" style="height: 100%; width: 100%;"></div>
                        </div>
                    </div>
                </section>

                <!-- Customers Section -->
                <section id="admin_customers" class="admin_section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 class="admin_panel-title">Customers Management</h2>
                        <button class="admin_btn admin_btn-primary" onclick="admin_addNewCustomer()">Add New Customer</button>
                    </div>

                    <div class="admin_products-panel">
                        <table class="admin_products-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>Total Orders</th>
                                    <th>Total Spent (PKR)</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin_customers-table-body">
                                <!-- Customers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="admin_analytics" class="admin_section">
                    <h2 class="admin_panel-title">Analytics & Reports</h2>
                    
                    <div class="admin_stats-grid">
                        <div class="admin_stat-card">
                            <h3><span class="admin_currency">PKR</span> <span id="admin_monthly-revenue">0</span></h3>
                            <p>Monthly Revenue</p>
                        </div>
                        <div class="admin_stat-card">
                            <h3 id="admin_monthly-orders">0</h3>
                            <p>Monthly Orders</p>
                        </div>
                        <div class="admin_stat-card">
                            <h3 id="admin_new-customers">0</h3>
                            <p>New Customers</p>
                        </div>
                        <div class="admin_stat-card">
                            <h3 id="admin_rider-efficiency">0%</h3>
                            <p>Delivery Efficiency</p>
                        </div>
                    </div>

                    <div style="display: grid; gap: 1rem; margin-top: 2rem;">
                        <button class="admin_btn admin_btn-secondary" onclick="admin_downloadDailyReport()">Download Daily Report</button>
                        <button class="admin_btn admin_btn-secondary" onclick="admin_downloadMonthlyReport()">Download Monthly Report</button>
                        <button class="admin_btn admin_btn-secondary" onclick="admin_downloadCustomerReport()">Download Customer Report</button>
                    </div>
                </section>
            </div>
        </main>

        <!-- Product Modal -->
        <div id="admin_product-modal" class="admin_modal">
            <div class="admin_modal-content">
                <div class="admin_modal-header">
                    <h3 id="admin_product-modal-title">Add New Product</h3>
                    <button class="admin_close-btn" onclick="admin_closeModal('admin_product-modal')">&times;</button>
                </div>
                <form id="admin_product-form" onsubmit="admin_saveProduct(event)">
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_product-name">Product Name</label>
                        <input type="text" id="admin_product-name" name="name" class="admin_form-input" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_product-category">Category</label>
                        <select id="admin_product-category" name="category" class="admin_form-select" required>
                            <option value="">Select Category</option>
                            <option value="Pizza">Pizza</option>
                            <option value="Chinese">Chinese</option>
                            <option value="Rice">Rice</option>
                            <option value="Burger">Burger</option>
                            <option value="Broast">Broast</option>
                            <option value="Sandwiches">Sandwiches</option>
                            <option value="BBQ">BBQ</option>
                            <option value="Karahi">Karahi</option>
                            <option value="Handi">Handi</option>
                            <option value="Salan">Salan</option>
                            <option value="Roll">Roll</option>
                            <option value="Fries">Fries</option>
                            <option value="Sweets">Sweets</option>
                            <option value="Sides">Sides</option>
                            <option value="Beverages">Beverages</option>
                            <option value="FISH">FISH</option>
                        </select>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_product-price">Price (PKR)</label>
                        <input type="number" id="admin_product-price" name="price" class="admin_form-input" min="0" step="0.01" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_product-stock">Stock Quantity</label>
                        <input type="number" id="admin_product-stock" name="stock" class="admin_form-input" min="0" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_product-image">Image URL</label>
                        <input type="url" id="admin_product-image" name="imageUrl" class="admin_form-input">
                    </div>
                    <div class="admin_actions">
                        <button type="submit" class="admin_btn admin_btn-primary">Save Product</button>
                        <button type="button" class="admin_btn admin_btn-secondary" onclick="admin_closeModal('admin_product-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Rider Modal -->
        <div id="admin_rider-modal" class="admin_modal">
            <div class="admin_modal-content">
                <div class="admin_modal-header">
                    <h3 id="admin_rider-modal-title">Add New Rider</h3>
                    <button class="admin_close-btn" onclick="admin_closeModal('admin_rider-modal')">&times;</button>
                </div>
                <form id="admin_rider-form" onsubmit="admin_saveRider(event)">
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_rider-name">Rider Name</label>
                        <input type="text" id="admin_rider-name" name="name" class="admin_form-input" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_rider-phone">Phone Number</label>
                        <input type="tel" id="admin_rider-phone" name="phone" class="admin_form-input" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_rider-email">Email</label>
                        <input type="email" id="admin_rider-email" name="email" class="admin_form-input">
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_rider-vehicle">Vehicle Type</label>
                        <select id="admin_rider-vehicle" name="vehicleType" class="admin_form-select" required>
                            <option value="">Select Vehicle</option>
                            <option value="bike">Bike</option>
                            <option value="car">Car</option>
                            <option value="bicycle">Bicycle</option>
                            <option value="scooter">Scooter</option>
                        </select>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_rider-license">License Number</label>
                        <input type="text" id="admin_rider-license" name="licenseNumber" class="admin_form-input">
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_rider-username">Username</label>
                        <input type="text" id="admin_rider-username" name="username" class="admin_form-input" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_rider-password">Password</label>
                        <input type="password" id="admin_rider-password" name="password" class="admin_form-input">
                    </div>
                    <div class="admin_actions">
                        <button type="submit" class="admin_btn admin_btn-primary">Save Rider</button>
                        <button type="button" class="admin_btn admin_btn-secondary" onclick="admin_closeModal('admin_rider-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Customer Modal -->
        <div id="admin_customer-modal" class="admin_modal">
            <div class="admin_modal-content">
                <div class="admin_modal-header">
                    <h3 id="admin_customer-modal-title">Add New Customer</h3>
                    <button class="admin_close-btn" onclick="admin_closeModal('admin_customer-modal')">&times;</button>
                </div>
                <form id="admin_customer-form" onsubmit="admin_saveCustomer(event)">
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_customer-name">Customer Name</label>
                        <input type="text" id="admin_customer-name" name="name" class="admin_form-input" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_customer-phone">Phone Number</label>
                        <input type="tel" id="admin_customer-phone" name="phone" class="admin_form-input" required>
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_customer-email">Email</label>
                        <input type="email" id="admin_customer-email" name="email" class="admin_form-input">
                    </div>
                    <div class="admin_form-group">
                        <label class="admin_form-label" for="admin_customer-address">Address</label>
                        <textarea id="admin_customer-address" name="address" class="admin_form-textarea"></textarea>
                    </div>
                    <div class="admin_actions">
                        <button type="submit" class="admin_btn admin_btn-primary">Save Customer</button>
                        <button type="button" class="admin_btn admin_btn-secondary" onclick="admin_closeModal('admin_customer-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Rider App Page (from index (99).html - ONLY Rider App section) -->
    <div id="rider-view-container" class="page-content">
        <div class="page-container">
            <div class="riderApp_rider-container">
                <!-- Login Form -->
                <div id="riderApp_rider-login" class="riderApp_rider-content">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: #d32f2f; margin-bottom: 0.5rem;">🏍️ Rider Login</h2>
                        <p style="color: #666;">Enter your credentials to continue</p>
                    </div>
                    
                    <form id="riderApp_rider-login-form">
                        <div class="riderApp_form-group">
                            <label class="riderApp_form-label">Rider ID</label>
                            <input type="text" id="riderApp_login-rider-id" class="riderApp_form-input" placeholder="Enter your Rider ID" required>
                        </div>
                        <div class="riderApp_form-group">
                            <label class="riderApp_form-label">Phone Number</label>
                            <input type="tel" id="riderApp_login-phone" class="riderApp_form-input" placeholder="03xxxxxxxxx" required>
                        </div>
                        <button type="submit" class="riderApp_btn-rider primary">Login</button>
                    </form>
                </div>

                <!-- Rider Dashboard -->
                <div id="riderApp_rider-dashboard" class="riderApp_rider-content" style="display: none;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: #d32f2f;">Welcome, <span id="riderApp_rider-name-display">Rider</span>!</h2>
                        <button class="riderApp_btn-rider danger" style="width: auto; padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="riderApp_logoutRider()">Logout</button>
                    </div>

                    <!-- Status Card -->
                    <div class="riderApp_rider-status-card">
                        <div class="riderApp_status-indicator">
                            <div class="riderApp_status-dot" id="riderApp_rider-status-dot"></div>
                            <span><strong>Status:</strong> <span id="riderApp_rider-status-text">Offline</span></span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="riderApp_btn-rider success" style="flex: 1;" onclick="riderApp_updateRiderStatus('online')">Go Online</button>
                            <button class="riderApp_btn-rider danger" style="flex: 1;" onclick="riderApp_updateRiderStatus('offline')">Go Offline</button>
                        </div>
                    </div>

                    <!-- Location Card -->
                    <div class="riderApp_rider-status-card">
                        <h4 style="margin-bottom: 1rem;">📍 Live Location Tracking</h4>
                        <div id="riderApp_location-info">
                            <p>Location not available</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            <button class="riderApp_btn-rider primary" onclick="riderApp_startLiveTracking()" id="riderApp_start-tracking-btn" style="flex: 1;">🔴 Start Live Tracking</button>
                            <button class="riderApp_btn-rider danger" onclick="riderApp_stopLiveTracking()" id="riderApp_stop-tracking-btn" style="flex: 1; display: none;">⏹️ Stop Tracking</button>
                        </div>
                        <div id="riderApp_tracking-status" style="margin-top: 0.5rem; text-align: center; font-size: 0.9rem; color: #666;"></div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="riderApp_rider-status-card">
                        <h4 style="margin-bottom: 1rem;">⚡ Quick Actions</h4>
                        <button class="riderApp_btn-rider primary" style="margin-bottom: 0.5rem;" onclick="riderApp_updateRiderStatus('busy')">Mark as Busy</button>
                        <button class="riderApp_btn-rider success" style="margin-bottom: 0.5rem;" onclick="riderApp_updateRiderStatus('online')">Mark as Available</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Page (from new rider.html) -->
    <div id="newrider_admin-view-container" class="page-content">
        <div class="container">
            <!-- Add Rider Form -->
            <div class="add-rider-form">
                <h2 style="margin-bottom: 1.5rem; color: #d32f2f;">➕ Add New Rider</h2>
                <form id="newrider_add-rider-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Rider ID</label>
                            <input type="text" id="newrider_rider-id" class="form-input" placeholder="e.g., NOMAN006" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" id="newrider_rider-name" class="form-input" placeholder="Enter rider name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" id="newrider_rider-phone" class="form-input" placeholder="03xxxxxxxxx" required>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-success" style="flex: 1;">Add Rider to Database</button>
                        <button type="button" class="btn btn-primary" onclick="newrider_clearAllRiders()" style="flex: 1;">🗑️ Clear All Riders</button>
                    </div>
                </form>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon primary">👥</div>
                        <div class="stat-info">
                            <h3>Total Riders</h3>
                            <p id="newrider_total-riders">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon success">🟢</div>
                        <div class="stat-info">
                            <h3>Online</h3>
                            <p id="newrider_online-riders">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon warning">🟡</div>
                        <div class="stat-info">
                            <h3>Busy</h3>
                            <p id="newrider_busy-riders">0</p>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon gray">⚫</div>
                        <div class="stat-info">
                            <h3>Offline</h3>
                            <p id="newrider_offline-riders">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Map Section -->
                <div class="section-card">
                    <div class="section-header">
                        <div class="section-title">
                            🗺️ Live Rider Locations
                        </div>
                        <button class="btn btn-secondary" onclick="newrider_refreshAdminData()">🔄 Refresh</button>
                    </div>
                    <div id="newrider_admin_map"></div>
                    <div class="map-info">
                        Last updated: <span id="newrider_last-update">--</span>
                    </div>
                </div>

                <!-- Riders List -->
                <div class="section-card">
                    <div class="section-header">
                        <div class="section-title">
                            👥 Active Riders
                        </div>
                        <button class="btn btn-secondary" onclick="newrider_loadRiders()">🔄 Refresh</button>
                    </div>
                    <div class="riders-list" id="newrider_riders-list">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            Loading riders...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rider App Page (from new rider.html) -->
    <div id="newrider_rider-view-container" class="page-content">
        <div class="container">
            <div class="rider-container">
                <!-- Login Form -->
                <div id="newrider_rider-login" class="rider-content">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: #d32f2f; margin-bottom: 0.5rem;">🏍️ Rider Login</h2>
                        <p style="color: #666;">Enter your credentials to continue</p>
                    </div>
                    
                    <form id="newrider_rider-login-form">
                        <div class="form-group">
                            <label class="form-label">Rider ID</label>
                            <input type="text" id="newrider_login-rider-id" class="form-input" placeholder="Enter your Rider ID" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" id="newrider_login-phone" class="form-input" placeholder="03xxxxxxxxx" required>
                        </div>
                        <button type="submit" class="btn-rider primary">Login</button>
                    </form>
                </div>

                <!-- Rider Dashboard -->
                <div id="newrider_rider-dashboard" class="rider-content" style="display: none;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: #d32f2f;">Welcome, <span id="newrider_rider-name-display">Rider</span>!</h2>
                        <button class="btn-rider danger" style="width: auto; padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="newrider_logoutRider()">Logout</button>
                    </div>

                    <!-- Status Card -->
                    <div class="rider-status-card">
                        <div class="status-indicator">
                            <div class="status-dot" id="newrider_rider-status-dot"></div>
                            <span><strong>Status:</strong> <span id="newrider_rider-status-text">Offline</span></span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-rider success" style="flex: 1;" onclick="newrider_updateRiderStatus('online')">Go Online</button>
                            <button class="btn-rider danger" style="flex: 1;" onclick="newrider_updateRiderStatus('offline')">Go Offline</button>
                        </div>
                    </div>

                    <!-- Location Card -->
                    <div class="rider-status-card">
                        <h4 style="margin-bottom: 1rem;">📍 Live Location Tracking</h4>
                        <div id="newrider_location-info">
                            <p>Location not available</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            <button class="btn-rider primary" onclick="newrider_startLiveTracking()" id="newrider_start-tracking-btn" style="flex: 1;">🔴 Start Live Tracking</button>
                            <button class="btn-rider danger" onclick="newrider_stopLiveTracking()" id="newrider_stop-tracking-btn" style="flex: 1; display: none;">⏹️ Stop Tracking</button>
                        </div>
                        <div id="newrider_tracking-status" style="margin-top: 0.5rem; text-align: center; font-size: 0.9rem; color: #666;"></div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="rider-status-card">
                        <h4 style="margin-bottom: 1rem;">⚡ Quick Actions</h4>
                        <button class="btn-rider primary" style="margin-bottom: 0.5rem;" onclick="newrider_updateRiderStatus('busy')">Mark as Busy</button>
                        <button class="btn-rider success" style="margin-bottom: 0.5rem;" onclick="newrider_updateRiderStatus('online')">Mark as Available</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Embedded Leaflet JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        /* Leaflet JS (from https://unpkg.com/leaflet/dist/leaflet.js and https://unpkg.com/leaflet@1.7.1/dist/leaflet.js) */
        /*
         L.Draggable is a re-usable utility class to create drag&drop capabilities for any element (as long as it has a class
         with position:absolute or fixed). Simply pass the element to the constructor and call #enable to start dragging.
         @namespace
         @class L.Draggable
         @aka Draggable
         */
        L.Draggable = L.Handler.extend({
            initialize: function (element, dragStartTarget) {
                this._element = element;
                this._dragStartTarget = dragStartTarget || element;
            },

            enable: function () {
                if (this._enabled) {
                    return;
                }
                L.DomEvent.on(this._dragStartTarget, 'mousedown', this._onDown, this);
                this._enabled = true;
            },

            disable: function () {
                if (!this._enabled) {
                    return;
                }
                L.DomEvent.off(this._dragStartTarget, 'mousedown', this._onDown, this);
                this._enabled = false;
            },

            _onDown: function (e) {
                if (!(e.which === 1 && L.Draggable.START)) { return; }

                L.DomEvent.preventDefault(e);

                L.DomEvent.on(this._element, 'mouseup', this._onUp, this);
                L.DomEvent.on(document, 'mousemove', this._onMove, this); // Use document for move event
                L.DomEvent.on(document, 'mouseup', this._onUp, this);

                if (L.Draggable.DRAG) { L.Draggable.DRAG.disable(); }
                L.Draggable.DRAG = this;

                this._moved = false;
                this._startPos = L.DomUtil.get(this._element)._leaflet_pos;
                this._newPos = this._startPos.clone();
            },

            _onMove: function (e) {
                if (!this._moved) {
                    this._moved = true;
                    this._element.classList.add('leaflet-dragging');
                    this.fire('dragstart');
                }

                this._newPos.x = this._startPos.x + e.clientX - this._startPos.x;
                this._newPos.y = this._startPos.y + e.clientY - this._startPos.y;

                L.DomUtil.setPosition(this._element, this._newPos);
                this.fire('drag');
            },

            _onUp: function (e) {
                L.DomEvent.off(this._element, 'mouseup', this._onUp, this);
                L.DomEvent.off(document, 'mousemove', this._onMove, this);
                L.DomEvent.off(document, 'mouseup', this._onUp, this);

                this._element.classList.remove('leaflet-dragging');
                this.fire('dragend');

                if (L.Draggable.DRAG === this) { L.Draggable.DRAG = null; }
            }
        });
    </script>

    <script>
        // --- IndexedDB Wrapper ---
        const DB_NAME = 'NomanRestaurantDB';
        const DB_VERSION = 1;
        let db = null;

        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onupgradeneeded = (event) => {
                    const dbInstance = event.target.result;
                    if (!dbInstance.objectStoreNames.contains('products')) {
                        const store = dbInstance.createObjectStore('products', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('name', 'name', { unique: false });
                        store.createIndex('category', 'category', { unique: false });
                    }
                    if (!dbInstance.objectStoreNames.contains('riders')) {
                        const store = dbInstance.createObjectStore('riders', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('rider_id', 'rider_id', { unique: true });
                        store.createIndex('phone', 'phone', { unique: false });
                        store.createIndex('status', 'status', { unique: false });
                    }
                    if (!dbInstance.objectStoreNames.contains('customers')) {
                        const store = dbInstance.createObjectStore('customers', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('phone', 'phone', { unique: false });
                    }
                    if (!dbInstance.objectStoreNames.contains('orders')) {
                        const store = dbInstance.createObjectStore('orders', { keyPath: 'id', autoIncrement: true });
                        store.createIndex('customer_id', 'customer_id', { unique: false });
                        store.createIndex('rider_id', 'rider_id', { unique: false });
                        store.createIndex('status', 'status', { unique: false });
                        store.createIndex('order_number', 'order_number', { unique: false }); // order_number might not be strictly unique if it's a display ID, but DB key is 'id'
                    }
                };

                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log("IndexedDB opened successfully");
                    resolve(db);
                };

                request.onerror = (event) => {
                    console.error('IndexedDB error:', event.target.error);
                    reject(event.target.error);
                };
            });
        }

        function withStore(storeName, mode, callback) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    console.error('Database not open for store:', storeName);
                    return reject('Database not open.');
                }
                const transaction = db.transaction(storeName, mode);
                const store = transaction.objectStore(storeName);
                
                let req;
                try {
                    req = callback(store);
                } catch (e) {
                    reject(e);
                    return;
                }

                transaction.oncomplete = () => {
                    if (req && req.result !== undefined) {
                        resolve(req.result);
                    } else {
                        resolve(true); // Indicate success for operations like delete/clear
                    }
                };
                transaction.onerror = (event) => {
                    console.error(`Transaction error on ${storeName}:`, event.target.error);
                    reject(event.target.error);
                };
                transaction.onabort = () => {
                    console.warn(`Transaction aborted on ${storeName}`);
                    reject('Transaction aborted');
                };
            });
        }

        const indexedDBWrapper = {
            open: openDB,
            getAll: async (storeName) => {
                const results = await withStore(storeName, 'readonly', (store) => store.getAll());
                // Apply default values if missing (simulating schema evolution / default values)
                results.forEach(item => {
                    if (storeName === 'riders') {
                        if (item.status === undefined) item.status = 'offline';
                        if (item.latitude === undefined) item.latitude = 24.8607 + (Math.random() - 0.5) * 0.1;
                        if (item.longitude === undefined) item.longitude = 67.0011 + (Math.random() - 0.5) * 0.1;
                        if (item.is_online === undefined) item.is_online = (item.status === 'online');
                    } else if (storeName === 'products') {
                        if (item.available === undefined) item.available = true;
                    } else if (storeName === 'customers') {
                        if (item.total_orders === undefined) item.total_orders = 0;
                        if (item.total_spent === undefined) item.total_spent = 0;
                        if (item.is_vip === undefined) item.is_vip = false;
                    }
                });
                return results;
            },
            get: (storeName, id) => withStore(storeName, 'readonly', (store) => store.get(id)),
            add: (storeName, data) => withStore(storeName, 'readwrite', (store) => store.add(data)),
            put: (storeName, data) => withStore(storeName, 'readwrite', (store) => store.put(data)),
            delete: (storeName, id) => withStore(storeName, 'readwrite', (store) => store.delete(id)),
            clear: (storeName) => withStore(storeName, 'readwrite', (store) => store.clear()),
            queryByIndex: (storeName, indexName, queryValue) => withStore(storeName, 'readonly', (store) => {
                const index = store.index(indexName);
                return index.get(queryValue);
            }),
            queryAllByIndex: (storeName, indexName, queryValue) => withStore(storeName, 'readonly', (store) => {
                const index = store.index(indexName);
                return index.getAll(queryValue);
            }),
            count: (storeName) => withStore(storeName, 'readonly', (store) => store.count())
        };

        // --- Global Helper Functions ---
        function main_showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId + '-view-container').classList.add('active');
            
            document.querySelectorAll('.main_nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Find the button that was clicked or match by pageId
            const clickedButton = event ? event.target : document.querySelector(`.main_nav-btn[onclick*="${pageId}"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }

            // Initialize page-specific functionality
            if (pageId === 'admin') {
                setTimeout(() => {
                    admin_initializeApp(); // Re-initialize admin section on switch
                }, 100);
            } else if (pageId === 'rider') {
                 // Nothing specific to initialize on switch yet
            } else if (pageId === 'newrider_admin') {
                setTimeout(() => {
                    newrider_initializeMap();
                    newrider_loadRiders();
                }, 100);
            } else if (pageId === 'newrider_rider') {
                // Initialize newrider app page specific logic here
                newrider_init();
            }
        }

        function main_showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `admin_alert admin_alert-${type}`; // Using admin alert styles
            alertDiv.textContent = message;
            
            const currentPage = document.querySelector('.page-content.active .admin_container, .page-content.active .page-container, .page-content.active .newrider_container');
            if (currentPage) {
                currentPage.insertBefore(alertDiv, currentPage.firstChild);
            } else {
                document.body.prepend(alertDiv);
            }
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // --- Customer View Logic (from index_updated.html) ---
        function customer_selectOption(option, event) {
            const buttons = document.querySelectorAll('.customer_option-button');
            const deliveryAreas = document.getElementById('customer_deliveryAreas');
            
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            if (event) event.target.classList.add('selected');
            
            if (option === 'delivery') {
                deliveryAreas.classList.add('show');
            } else {
                deliveryAreas.classList.remove('show');
            }
        }

        function customer_selectArea(area, event) {
            const areaItems = document.querySelectorAll('.customer_area-item');
            const deliverySection = document.querySelector('.customer_delivery-section');
            const deliveryAreas = document.getElementById('customer_deliveryAreas');
            
            areaItems.forEach(item => item.classList.remove('selected'));
            
            if (event) event.target.classList.add('selected');
            
            setTimeout(() => {
                deliveryAreas.classList.remove('show');
                deliverySection.classList.add('minimized');
            }, 500);
            
            console.log('Selected delivery area:', area);
        }

        function customer_init() {
            document.querySelectorAll('.customer_nav-link').forEach(link => {
                link.removeEventListener('click', customer_handleNavLinkClick); // Prevent double listeners
                link.addEventListener('click', customer_handleNavLinkClick);
            });

            const customer_navContainer = document.querySelector('.customer_nav-container');
            if (customer_navContainer) {
                let isDown = false;
                let startX;
                let scrollLeft;

                customer_navContainer.addEventListener('mousedown', (e) => {
                    isDown = true;
                    startX = e.pageX - customer_navContainer.offsetLeft;
                    scrollLeft = customer_navContainer.scrollLeft;
                });

                customer_navContainer.addEventListener('mouseleave', () => {
                    isDown = false;
                });

                customer_navContainer.addEventListener('mouseup', () => {
                    isDown = false;
                });

                customer_navContainer.addEventListener('mousemove', (e) => {
                    if (!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - customer_navContainer.offsetLeft;
                    const walk = (x - startX) * 2;
                    customer_navContainer.scrollLeft = scrollLeft - walk;
                });
            }
        }

        function customer_handleNavLinkClick(e) {
            e.preventDefault();
            const target = this.getAttribute('href');
            const deliverySection = document.querySelector('.customer_delivery-section');
            
            deliverySection.classList.add('minimized');
            
            if (target.startsWith('#')) {
                const targetElement = document.querySelector(target);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        }

        // --- Admin Panel Logic (from admin (60).html) ---
        let admin_currentSection = 'admin_dashboard';
        let admin_currentEditingId = null;
        let admin_dashboard_map = null;
        let admin_riders_map = null;
        let admin_riderMarkers = {};

        let admin_orders = [];
        let admin_products = [];
        let admin_riders = [];
        let admin_customers = [];

        async function admin_initializeApp() {
            admin_setupEventListeners();
            await admin_loadAllData();
            admin_loadDashboardData();
            admin_initializeMaps();
            // No real-time subscriptions needed for IndexedDB, data loads on changes or refresh
            
            // Re-select active button for admin panel
            document.querySelectorAll('.admin_nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-section="${admin_currentSection}"]`).classList.add('active');
            document.querySelectorAll('.admin_section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(admin_currentSection).classList.add('active');
        }

        function admin_setupEventListeners() {
            document.querySelectorAll('.admin_nav-btn').forEach(btn => {
                btn.removeEventListener('click', admin_handleNavBtnClick); // Prevent duplicate listeners
                btn.addEventListener('click', admin_handleNavBtnClick);
            });

            document.removeEventListener('click', admin_handleModalOutsideClick); // Prevent duplicate listeners
            document.addEventListener('click', admin_handleModalOutsideClick);
        }

        function admin_handleNavBtnClick() {
            admin_switchSection(this.dataset.section);
        }

        function admin_handleModalOutsideClick(event) {
            if (event.target.classList.contains('admin_modal')) {
                const modal = event.target;
                modal.style.display = 'none';
                admin_currentEditingId = null;
            }
        }

        function admin_switchSection(sectionName) {
            document.querySelectorAll('.admin_nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            document.querySelectorAll('.admin_section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');

            admin_currentSection = sectionName;

            if (sectionName === 'admin_riders' && !admin_riders_map) {
                setTimeout(() => admin_initializeRidersMap(), 100);
            }
            if (sectionName === 'admin_dashboard' && !admin_dashboard_map) {
                setTimeout(() => admin_initializeMaps(), 100);
            }
        }

        async function admin_loadAllData() {
            try {
                await Promise.all([
                    admin_loadProductsData(),
                    admin_loadRidersData(),
                    admin_loadCustomersData(),
                    admin_loadOrdersData()
                ]);
            } catch (error) {
                console.error('Error loading data:', error);
                admin_showToast('Error loading data from database', 'error');
            }
        }

        function admin_loadDashboardData() {
            document.getElementById('admin_total-orders').textContent = admin_orders.length;
            document.getElementById('admin_total-revenue').textContent = admin_orders.reduce((sum, order) => sum + (order.total || 0), 0).toLocaleString();
            
            document.getElementById('admin_active-riders').textContent = admin_riders.filter(r => r.status === 'online').length;
            document.getElementById('admin_pending-orders').textContent = admin_orders.filter(o => o.status === 'pending').length;
            
            const admin_avgOrder = admin_orders.reduce((sum, order) => sum + (order.total || 0), 0) / (admin_orders.length || 1);
            document.getElementById('admin_avg-order').textContent = Math.round(admin_avgOrder);
            
            document.getElementById('admin_avg-delivery').textContent = Math.floor(Math.random() * 20) + 20;
            document.getElementById('admin_satisfaction').textContent = (4.5 + Math.random() * 0.4).toFixed(1);
            
            document.getElementById('admin_popular-item').textContent = admin_products.length > 0 ? admin_products[Math.floor(Math.random() * admin_products.length)].name : 'N/A';
            
            document.getElementById('admin_monthly-revenue').textContent = (Math.random() * 500000 + 1000000).toFixed(0);
            document.getElementById('admin_monthly-orders').textContent = Math.floor(Math.random() * 1000) + 2000;
            document.getElementById('admin_new-customers').textContent = Math.floor(Math.random() * 50) + 50;
            document.getElementById('admin_rider-efficiency').textContent = Math.floor(Math.random() * 10) + 85 + '%';
        }

        // Orders management
        async function admin_loadOrdersData() {
            try {
                const data = await indexedDBWrapper.getAll('orders');
                const customersData = await indexedDBWrapper.getAll('customers');
                const ridersData = await indexedDBWrapper.getAll('riders');

                admin_orders = data.map(order => ({
                    id: order.id,
                    orderNumber: order.order_number,
                    customer: customersData.find(c => c.id === order.customer_id)?.name || 'Unknown Customer',
                    customer_id: order.customer_id,
                    items: order.items,
                    total: parseFloat(order.total || 0),
                    status: order.status || 'pending',
                    time: order.order_time,
                    rider: ridersData.find(r => r.id === order.rider_id)?.name || null,
                    rider_id: order.rider_id
                }));

                const container = document.getElementById('admin_orders-container');
                container.innerHTML = admin_orders.map(order => `
                    <div class="admin_order-card">
                        <div class="admin_order-header">
                            <span class="admin_order-id">${order.orderNumber}</span>
                            <span class="admin_order-status admin_status-${order.status}">${order.status}</span>
                        </div>
                        <div>
                            <strong>Customer:</strong> ${order.customer}<br>
                            <strong>Items:</strong> ${order.items ? order.items.join(', ') : 'N/A'}<br>
                            <strong>Total:</strong> <span class="admin_currency">PKR</span> ${order.total.toLocaleString()}<br>
                            <strong>Time:</strong> ${order.time}
                            ${order.rider ? `<br><strong>Rider:</strong> ${order.rider}` : ''}
                        </div>
                        <div class="admin_actions" style="margin-top: 1rem;">
                            ${order.status === 'pending' ? 
                                `<button class="admin_btn admin_btn-primary admin_btn-small" onclick="admin_confirmOrder(${order.id})">Confirm</button>
                                 <button class="admin_btn admin_btn-secondary admin_btn-small" onclick="admin_assignRider(${order.id})">Assign Rider</button>` : ''}
                            ${order.status === 'assigned' ? 
                                `<button class="admin_btn admin_btn-primary admin_btn-small" onclick="admin_markPicked(${order.id})">Mark Picked</button>` : ''}
                            ${order.status === 'picked' ? 
                                `<button class="admin_btn admin_btn-primary admin_btn-small" onclick="admin_markDelivered(${order.id})">Mark Delivered</button>` : ''}
                            <button class="admin_btn admin_btn-danger admin_btn-small" onclick="admin_cancelOrder(${order.id})">Cancel</button>
                        </div>
                    </div>
                `).join('');
                admin_loadDashboardData();
            } catch (error) {
                console.error('Database error (loadOrdersData):', error);
                admin_showToast('Failed to load orders', 'error');
            }
        }

        function admin_refreshOrders() {
            admin_loadOrdersData();
            admin_showToast('Orders refreshed successfully!', 'success');
        }

        async function admin_confirmOrder(orderId) {
            try {
                const order = admin_orders.find(o => o.id === orderId);
                if (!order) throw new Error("Order not found");

                const updatedOrder = { ...order, status: 'confirmed' };
                await indexedDBWrapper.put('orders', updatedOrder);

                admin_loadOrdersData();
                admin_showToast(`Order ${order.orderNumber} confirmed!`, 'success');
            } catch (error) {
                console.error('Error confirming order:', error);
                admin_showToast(`Failed to confirm order: ${error.message}`, 'error');
            }
        }

        async function admin_assignRider(orderId) {
            try {
                const availableRiders = admin_riders.filter(r => r.status === 'online');

                if (availableRiders.length === 0) {
                    admin_showToast('No available riders!', 'error');
                    return;
                }
                
                const order = admin_orders.find(o => o.id === orderId);
                if (!order) throw new Error("Order not found");

                const riderToAssign = availableRiders[0];
                
                const updatedOrder = { ...order, status: 'assigned', rider_id: riderToAssign.id };
                await indexedDBWrapper.put('orders', updatedOrder);

                // Optionally, set rider status to busy (if not already handled by the rider app itself)
                const updatedRider = { ...riderToAssign, status: 'busy' };
                await indexedDBWrapper.put('riders', updatedRider);

                admin_loadOrdersData();
                admin_loadRidersData(); // Refresh riders to show busy status
                admin_showToast(`Order ${order.orderNumber} assigned to ${riderToAssign.name}!`, 'success');
            } catch (error) {
                console.error('Error assigning rider:', error);
                admin_showToast(`Failed to assign rider: ${error.message}`, 'error');
            }
        }

        async function admin_markPicked(orderId) {
            try {
                const order = admin_orders.find(o => o.id === orderId);
                if (!order) throw new Error("Order not found");

                const updatedOrder = { ...order, status: 'picked' };
                await indexedDBWrapper.put('orders', updatedOrder);
                
                admin_loadOrdersData();
                admin_showToast(`Order ${order.orderNumber} picked up!`, 'success');
            } catch (error) {
                console.error('Error marking picked:', error);
                admin_showToast(`Failed to mark order picked: ${error.message}`, 'error');
            }
        }

        async function admin_markDelivered(orderId) {
            try {
                const order = admin_orders.find(o => o.id === orderId);
                if (!order) throw new Error("Order not found");

                const updatedOrder = { ...order, status: 'delivered' };
                await indexedDBWrapper.put('orders', updatedOrder);
                
                if (order.rider_id) {
                    const rider = await indexedDBWrapper.get('riders', order.rider_id);
                    if (rider) {
                        const updatedRider = { ...rider, status: 'online' }; // Free up rider
                        await indexedDBWrapper.put('riders', updatedRider);
                    }
                }
                
                admin_loadOrdersData();
                admin_loadRidersData(); // Refresh riders to show available status
                admin_loadDashboardData();
                admin_showToast(`Order ${order.orderNumber} delivered!`, 'success');
            } catch (error) {
                console.error('Error marking delivered:', error);
                admin_showToast('Failed to mark order delivered', 'error');
            }
        }

        async function admin_cancelOrder(orderId) {
            if (confirm('Are you sure you want to cancel this order?')) {
                try {
                    const order = admin_orders.find(o => o.id === orderId);
                    if (!order) throw new Error("Order not found");

                    const updatedOrder = { ...order, status: 'cancelled' };
                    await indexedDBWrapper.put('orders', updatedOrder);
                    
                    if (order.rider_id) {
                        const rider = await indexedDBWrapper.get('riders', order.rider_id);
                        if (rider) {
                            const updatedRider = { ...rider, status: 'online' }; // Free up rider
                            await indexedDBWrapper.put('riders', updatedRider);
                        }
                    }
                    
                    admin_loadOrdersData();
                    admin_loadRidersData(); // Refresh riders
                    admin_loadDashboardData();
                    admin_showToast(`Order ${order.orderNumber} cancelled!`, 'success');
                } catch (error) {
                    console.error('Error cancelling order:', error);
                    admin_showToast('Failed to cancel order', 'error');
                }
            }
        }

        // Products management
        async function admin_loadProductsData() {
            try {
                const data = await indexedDBWrapper.getAll('products');
                admin_products = data;
                const tbody = document.getElementById('admin_products-table-body');
                tbody.innerHTML = admin_products.map(product => `
                    <tr>
                        <td>
                            ${product.image_url ? 
                                `<img src="${product.image_url}" alt="${product.name}" class="admin_product-image">` :
                                `<div class="admin_image-placeholder">No Image</div>`
                            }
                        </td>
                        <td>${product.name}</td>
                        <td>${product.category}</td>
                        <td><span class="admin_currency">PKR</span> ${parseFloat(product.price).toLocaleString()}</td>
                        <td>${product.stock}</td>
                        <td>
                            <span class="admin_order-status ${product.available ? 'admin_status-available' : 'admin_status-offline'}">
                                ${product.available ? 'Available' : 'Unavailable'}
                            </span>
                        </td>
                        <td class="admin_actions">
                            <button class="admin_btn admin_btn-secondary admin_btn-small" onclick="admin_editProduct(${product.id})">Edit</button>
                            <button class="admin_btn admin_btn-${product.available ? 'secondary' : 'primary'} admin_btn-small" 
                                    onclick="admin_toggleProductAvailability(${product.id})">
                                ${product.available ? 'Disable' : 'Enable'}
                            </button>
                            <button class="admin_btn admin_btn-danger admin_btn-small" onclick="admin_deleteProduct(${product.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
                admin_loadDashboardData();
            } catch (error) {
                console.error('Database error (loadProductsData):', error);
                admin_showToast('Failed to load products', 'error');
            }
        }

        function admin_addNewProduct() {
            admin_currentEditingId = null;
            document.getElementById('admin_product-modal-title').textContent = 'Add New Product';
            document.getElementById('admin_product-form').reset();
            document.getElementById('admin_product-modal').style.display = 'block';
        }

        function admin_editProduct(productId) {
            const product = admin_products.find(p => p.id === productId);
            if (product) {
                admin_currentEditingId = productId;
                document.getElementById('admin_product-modal-title').textContent = 'Edit Product';
                
                document.getElementById('admin_product-name').value = product.name;
                document.getElementById('admin_product-category').value = product.category;
                document.getElementById('admin_product-price').value = product.price;
                document.getElementById('admin_product-stock').value = product.stock;
                document.getElementById('admin_product-image').value = product.image_url || '';
                
                document.getElementById('admin_product-modal').style.display = 'block';
            }
        }

        async function admin_saveProduct(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const productData = {
                name: formData.get('name'),
                category: formData.get('category'),
                price: parseFloat(formData.get('price')),
                stock: parseInt(formData.get('stock')),
                image_url: formData.get('imageUrl') || null,
                available: true
            };

            try {
                if (admin_currentEditingId) {
                    const existingProduct = admin_products.find(p => p.id === admin_currentEditingId);
                    await indexedDBWrapper.put('products', { ...existingProduct, ...productData, id: admin_currentEditingId });
                    admin_showToast('Product updated successfully!', 'success');
                } else {
                    await indexedDBWrapper.add('products', productData);
                    admin_showToast('Product added successfully!', 'success');
                }

                admin_closeModal('admin_product-modal');
                admin_loadProductsData();
            } catch (error) {
                console.error('Error saving product:', error);
                admin_showToast('Failed to save product: ' + error.message, 'error');
            }
        }

        async function admin_toggleProductAvailability(productId) {
            try {
                const product = admin_products.find(p => p.id === productId);
                if (product) {
                    const newAvailability = !product.available;
                    await indexedDBWrapper.put('products', { ...product, available: newAvailability });
                    admin_showToast(`Product ${newAvailability ? 'enabled' : 'disabled'}!`, 'success');
                    admin_loadProductsData();
                }
            } catch (error) {
                console.error('Error toggling product availability:', error);
                admin_showToast('Failed to toggle product availability', 'error');
            }
        }

        async function admin_deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    await indexedDBWrapper.delete('products', productId);
                    admin_showToast('Product deleted successfully!', 'success');
                    admin_loadProductsData();
                } catch (error) {
                    console.error('Error deleting product:', error);
                    admin_showToast(`Failed to delete product: ${error.message}`, 'error');
                }
            }
        }

        // Riders management
        async function admin_loadRidersData() {
            try {
                const data = await indexedDBWrapper.getAll('riders');
                admin_riders = data;

                const container = document.getElementById('admin_riders-container');
                container.innerHTML = admin_riders.map(rider => `
                    <div class="admin_rider-card">
                        <div class="admin_rider-info">
                            <div class="admin_rider-name">${rider.name}</div>
                            <div class="admin_rider-details">
                                ${rider.phone} | ${rider.vehicle_type || 'N/A'}<br>
                                ${rider.latitude && rider.longitude ? `Location: ${rider.latitude.toFixed(4)}, ${rider.longitude.toFixed(4)}` : 'Location: Unknown'}<br>
                                Login: ${rider.username || 'N/A'}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="admin_rider-status admin_status-${rider.status || 'offline'}">
                                ${rider.status ? rider.status : 'Offline'}
                            </span>
                            <div class="admin_actions">
                                <button class="admin_btn admin_btn-secondary admin_btn-small" onclick="admin_editRider(${rider.id})">Edit</button>
                                <button class="admin_btn admin_btn-${rider.status === 'online' ? 'secondary' : 'primary'} admin_btn-small"
                                        onclick="admin_toggleRiderStatus(${rider.id})">
                                    ${rider.status === 'online' ? 'Deactivate' : 'Activate'}
                                </button>
                                <button class="admin_btn admin_btn-danger admin_btn-small" onclick="admin_deleteRider(${rider.id})">Delete</button>
                            </div>
                        </div>
                    </div>
                `).join('');

                admin_updateRiderLocations(); // for dashboard map
                if (admin_currentSection === 'admin_riders' && admin_riders_map) { // for riders section map
                    admin_updateRiderLocationsOnRidersMap();
                }
                admin_loadDashboardData();
            } catch (error) {
                console.error('Database error (loadRidersData):', error);
                admin_showToast('Failed to load riders', 'error');
            }
        }

        function admin_addNewRider() {
            admin_currentEditingId = null;
            document.getElementById('admin_rider-modal-title').textContent = 'Add New Rider';
            document.getElementById('admin_rider-form').reset();
            document.getElementById('admin_rider-modal').style.display = 'block';
        }

        function admin_editRider(riderId) {
            const rider = admin_riders.find(r => r.id === riderId);
            if (rider) {
                admin_currentEditingId = riderId;
                document.getElementById('admin_rider-modal-title').textContent = 'Edit Rider';
                
                document.getElementById('admin_rider-name').value = rider.name;
                document.getElementById('admin_rider-phone').value = rider.phone;
                document.getElementById('admin_rider-email').value = rider.email || '';
                document.getElementById('admin_rider-vehicle').value = rider.vehicle_type || '';
                document.getElementById('admin_rider-license').value = rider.license_number || '';
                document.getElementById('admin_rider-username').value = rider.username || '';
                document.getElementById('admin_rider-password').value = '';
                
                document.getElementById('admin_rider-modal').style.display = 'block';
            }
        }

        async function admin_saveRider(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const riderData = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                email: formData.get('email') || null,
                vehicle_type: formData.get('vehicleType'),
                license_number: formData.get('licenseNumber') || null,
                username: formData.get('username'),
            };

            const newPassword = formData.get('password');
            if (newPassword) {
                riderData.password = newPassword; // Store password (in real app, hash it)
            }

            try {
                if (admin_currentEditingId) {
                    const existingRider = admin_riders.find(r => r.id === admin_currentEditingId);
                    await indexedDBWrapper.put('riders', { ...existingRider, ...riderData, id: admin_currentEditingId });
                    admin_showToast('Rider updated successfully!', 'success');
                } else {
                    if (!newPassword) {
                        admin_showToast('New riders require a password.', 'error');
                        return;
                    }
                    riderData.status = 'offline';
                    riderData.latitude = 24.8607 + (Math.random() - 0.5) * 0.1;
                    riderData.longitude = 67.0011 + (Math.random() - 0.5) * 0.1;

                    await indexedDBWrapper.add('riders', riderData);
                    admin_showToast('New rider added successfully!', 'success');
                }

                admin_closeModal('admin_rider-modal');
                admin_loadRidersData();
            } catch (error) {
                console.error('Error saving rider:', error);
                admin_showToast('Failed to save rider: ' + error.message, 'error');
            }
        }

        async function admin_toggleRiderStatus(riderId) {
            try {
                const rider = admin_riders.find(r => r.id === riderId);
                if (rider) {
                    const newStatus = rider.status === 'online' ? 'offline' : 'online';
                    await indexedDBWrapper.put('riders', { ...rider, status: newStatus });
                    admin_showToast(`Rider ${rider.name} is now ${newStatus}!`, 'success');
                    admin_loadRidersData();
                }
            } catch (error) {
                console.error('Error toggling rider status:', error);
                admin_showToast('Failed to toggle rider status', 'error');
            }
        }

        async function admin_deleteRider(riderId) {
            if (confirm('Are you sure you want to delete this rider? This action cannot be undone.')) {
                try {
                    await indexedDBWrapper.delete('riders', riderId);
                    admin_showToast('Rider deleted successfully!', 'success');
                    admin_loadRidersData();
                } catch (error) {
                    console.error('Error deleting rider:', error);
                    admin_showToast(`Failed to delete rider: ${error.message}`, 'error');
                }
            }
        }

        // Customers management
        async function admin_loadCustomersData() {
            try {
                const data = await indexedDBWrapper.getAll('customers');
                admin_customers = data;
                const tbody = document.getElementById('admin_customers-table-body');
                tbody.innerHTML = admin_customers.map(customer => `
                    <tr>
                        <td>${customer.name}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.total_orders}</td>
                        <td><span class="admin_currency">PKR</span> ${parseFloat(customer.total_spent).toLocaleString()}</td>
                        <td>
                            <span class="admin_order-status ${customer.is_vip ? 'admin_status-available' : 'admin_status-pending'}">
                                ${customer.is_vip ? 'VIP' : 'Regular'}
                            </span>
                        </td>
                        <td class="admin_actions">
                            <button class="admin_btn admin_btn-secondary admin_btn-small" onclick="admin_editCustomer(${customer.id})">Edit</button>
                            <button class="admin_btn admin_btn-primary admin_btn-small" onclick="admin_viewCustomerOrders(${customer.id})">View Orders</button>
                            <button class="admin_btn admin_btn-danger admin_btn-small" onclick="admin_deleteCustomer(${customer.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
                admin_loadDashboardData();
            } catch (error) {
                console.error('Database error (loadCustomersData):', error);
                admin_showToast('Failed to load customers', 'error');
            }
        }

        function admin_addNewCustomer() {
            admin_currentEditingId = null;
            document.getElementById('admin_customer-modal-title').textContent = 'Add New Customer';
            document.getElementById('admin_customer-form').reset();
            document.getElementById('admin_customer-modal').style.display = 'block';
        }

        function admin_editCustomer(customerId) {
            const customer = admin_customers.find(c => c.id === customerId);
            if (customer) {
                admin_currentEditingId = customerId;
                document.getElementById('admin_customer-modal-title').textContent = 'Edit Customer';
                
                document.getElementById('admin_customer-name').value = customer.name;
                document.getElementById('admin_customer-phone').value = customer.phone;
                document.getElementById('admin_customer-email').value = customer.email || '';
                document.getElementById('admin_customer-address').value = customer.address || '';
                
                document.getElementById('admin_customer-modal').style.display = 'block';
            }
        }

        async function admin_saveCustomer(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const customerData = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                email: formData.get('email') || null,
                address: formData.get('address') || null,
            };

            try {
                if (admin_currentEditingId) {
                    const existingCustomer = admin_customers.find(c => c.id === admin_currentEditingId);
                    await indexedDBWrapper.put('customers', { ...existingCustomer, ...customerData, id: admin_currentEditingId });
                    admin_showToast('Customer updated successfully!', 'success');
                } else {
                    customerData.total_orders = 0;
                    customerData.total_spent = 0;
                    customerData.is_vip = false;

                    await indexedDBWrapper.add('customers', customerData);
                    admin_showToast('Customer added successfully!', 'success');
                }

                admin_closeModal('admin_customer-modal');
                admin_loadCustomersData();
            } catch (error) {
                console.error('Error saving customer:', error);
                admin_showToast('Failed to save customer: ' + error.message, 'error');
            }
        }

        function admin_viewCustomerOrders(customerId) {
            const customer = admin_customers.find(c => c.id === customerId);
            const customerOrders = admin_orders.filter(o => o.customer_id === customer.id);
            
            alert(`${customer.name} has ${customerOrders.length} orders:\n\n` + 
                  customerOrders.map(o => `${o.orderNumber}: PKR ${o.total.toLocaleString()} (${o.status})`).join('\n'));
        }

        async function admin_deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                try {
                    await indexedDBWrapper.delete('customers', customerId);
                    admin_showToast('Customer deleted successfully!', 'success');
                    admin_loadCustomersData();
                } catch (error) {
                    console.error('Error deleting customer:', error);
                    admin_showToast(`Failed to delete customer: ${error.message}`, 'error');
                }
            }
        }

        // Quick actions
        function admin_generateReport() {
            const reportData = {
                totalOrders: admin_orders.length,
                totalRevenue: admin_orders.reduce((sum, order) => sum + (order.total || 0), 0),
                activeRiders: admin_riders.filter(r => r.status === 'online').length,
                topProduct: admin_products.length > 0 ? admin_products.reduce((prev, current) => (prev.stock > current.stock) ? prev : current).name : 'N/A'
            };
            
            alert(`Daily Report Generated!\n\nTotal Orders: ${reportData.totalOrders}\nTotal Revenue: PKR ${reportData.totalRevenue.toLocaleString()}\nActive Riders: ${reportData.activeRiders}\nTop Product: ${reportData.topProduct}`);
            admin_showToast('Daily report generated!', 'success');
        }

        async function admin_exportData() {
            try {
                const productsData = await indexedDBWrapper.getAll('products');
                const ridersData = await indexedDBWrapper.getAll('riders');
                const customersData = await indexedDBWrapper.getAll('customers');
                const ordersData = await indexedDBWrapper.getAll('orders');

                const data = {
                    products: productsData || [],
                    riders: ridersData || [],
                    customers: customersData || [],
                    orders: ordersData || [],
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `noman-restaurant-data-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                admin_showToast('Data exported successfully!', 'success');
            } catch (error) {
                console.error('Export error:', error);
                admin_showToast('Failed to export data', 'error');
            }
        }

        function admin_downloadDailyReport() {
            const report = `Noman Restaurant - Daily Report
Date: ${new Date().toLocaleDateString()}

SUMMARY:
- Total Orders: ${admin_orders.length}
- Total Revenue: PKR ${admin_orders.reduce((sum, order) => sum + (order.total || 0), 0).toLocaleString()}
- Active Riders: ${admin_riders.filter(r => r.status === 'online').length}
- Customer Satisfaction: 4.7/5

ORDER STATUS:
- Pending: ${admin_orders.filter(o => o.status === 'pending').length}
- Delivered: ${admin_orders.filter(o => o.status === 'delivered').length}
- Cancelled: ${admin_orders.filter(o => o.status === 'cancelled').length}

TOP PRODUCTS:
${admin_products.slice(0, 5).map(p => `- ${p.name}: PKR ${parseFloat(p.price).toLocaleString()}`).join('\n')}
`;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daily-report-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            admin_showToast('Daily report downloaded!', 'success');
        }

        function admin_downloadMonthlyReport() {
            admin_showToast('Monthly report downloaded!', 'success');
        }

        function admin_downloadCustomerReport() {
            const report = `Noman Restaurant - Customer Report
Date: ${new Date().toLocaleDateString()}

CUSTOMER STATISTICS:
- Total Customers: ${admin_customers.length}
- VIP Customers: ${admin_customers.filter(c => c.is_vip).length}
- Total Customer Value: PKR ${admin_customers.reduce((sum, c) => sum + parseFloat(c.total_spent || 0), 0).toLocaleString()}

CUSTOMER LIST:
${admin_customers.map(c => `${c.name} - ${c.phone} - Orders: ${c.total_orders} - Spent: PKR ${parseFloat(c.total_spent || 0).toLocaleString()}`).join('\n')}
`;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `customer-report-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            admin_showToast('Customer report downloaded!', 'success');
        }

        // Map functions for admin panel
        function admin_initializeMaps() {
            try {
                if (admin_dashboard_map) { admin_dashboard_map.remove(); }
                admin_dashboard_map = L.map('admin_dashboard_map').setView([24.8607, 67.0011], 12);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(admin_dashboard_map);
                admin_updateRiderLocations();
            } catch (error) {
                console.error('Failed to initialize main admin map:', error);
                document.getElementById('admin_dashboard_map').innerHTML = '<div class="admin_loading">Map unavailable</div>';
            }
        }

        function admin_initializeRidersMap() {
            try {
                if (admin_riders_map) { admin_riders_map.remove(); }
                admin_riders_map = L.map('admin_riders_map').setView([24.8607, 67.0011], 12);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(admin_riders_map);
                admin_updateRiderLocationsOnRidersMap();
            } catch (error) {
                console.error('Failed to initialize riders section map:', error);
                document.getElementById('admin_riders_map').innerHTML = '<div class="admin_loading">Map unavailable</div>';
            }
        }

        function admin_updateRiderLocations() {
            if (!admin_dashboard_map) return;

            Object.values(admin_riderMarkers).forEach(marker => {
                admin_dashboard_map.removeLayer(marker);
            });
            admin_riderMarkers = {};

            admin_riders.forEach(rider => {
                if (rider.latitude && rider.longitude && rider.status === 'online') {
                    const marker = L.marker([rider.latitude, rider.longitude])
                        .bindPopup(`
                            <strong>${rider.name}</strong><br>
                            Status: ${rider.status}<br>
                            Vehicle: ${rider.vehicle_type || 'N/A'}<br>
                            Phone: ${rider.phone || 'N/A'}
                        `);
                    
                    marker.addTo(admin_dashboard_map);
                    admin_riderMarkers[rider.id] = marker;
                }
            });
        }

        function admin_updateRiderLocationsOnRidersMap() {
            if (!admin_riders_map) return;

            admin_riders_map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    admin_riders_map.removeLayer(layer);
                }
            });

            admin_riders.forEach(rider => {
                if (rider.latitude && rider.longitude) {
                    const marker = L.marker([rider.latitude, rider.longitude])
                        .bindPopup(`
                            <strong>${rider.name}</strong><br>
                            Status: ${rider.status}<br>
                            Vehicle: ${rider.vehicle_type || 'N/A'}<br>
                            Phone: ${rider.phone || 'N/A'}<br>
                            Location: ${rider.latitude.toFixed(4)}, ${rider.longitude.toFixed(4)}
                        `);
                    
                    marker.addTo(admin_riders_map);
                }
            });
        }

        // Real-time location simulation (simulate riders moving) - this updates IndexedDB, which triggers admin_loadRidersData
        setInterval(async () => {
            if (document.getElementById('admin-view-container').classList.contains('active') && db) {
                try {
                    const onlineRiders = admin_riders.filter(r => r.status === 'online' && r.latitude && r.longitude);
                    
                    for (const rider of onlineRiders) {
                        const newLat = rider.latitude + (Math.random() - 0.5) * 0.001;
                        const newLng = rider.longitude + (Math.random() - 0.5) * 0.001;
                        
                        await indexedDBWrapper.put('riders', { 
                            ...rider, // Spread existing properties
                            latitude: newLat, 
                            longitude: newLng,
                            updated_at: new Date().toISOString()
                        });
                    }
                    admin_loadRidersData(); // Refresh UI after all riders are updated
                } catch (error) {
                    console.error('Error simulating rider locations:', error);
                }
            }
        }, 15000); // Update every 15 seconds

        // Modal management
        function admin_closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            admin_currentEditingId = null;
        }

        // Toast notifications
        function admin_showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `admin_toast admin_toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // --- Rider App Logic (from index (99).html) ---
        let riderApp_currentRider = null;
        let riderApp_watchId = null;
        let riderApp_lastKnownPosition = null;

        async function riderApp_init() {
            document.getElementById('riderApp_rider-login-form').addEventListener('submit', riderApp_loginRider);
        }

        async function riderApp_loginRider(event) {
            event.preventDefault();
            
            const riderId = document.getElementById('riderApp_login-rider-id').value;
            const phone = document.getElementById('riderApp_login-phone').value;

            try {
                // Query by rider_id (unique index)
                const rider = await indexedDBWrapper.queryByIndex('riders', 'rider_id', riderId);

                if (!rider || rider.phone !== phone) {
                    throw new Error("Invalid credentials.");
                }

                riderApp_currentRider = rider;
                document.getElementById('riderApp_rider-name-display').textContent = rider.name;
                document.getElementById('riderApp_rider-login').style.display = 'none';
                document.getElementById('riderApp_rider-dashboard').style.display = 'block';
                
                riderApp_updateRiderStatusDisplay();
                riderApp_updateLocationDisplay();
                
                main_showAlert('Rider logged in successfully!', 'success');
            } catch (error) {
                console.error('Error logging in:', error);
                main_showAlert('Invalid credentials. Please check your Rider ID and phone number.', 'error');
            }
        }

        function riderApp_logoutRider() {
            if (riderApp_watchId !== null) {
                riderApp_stopLiveTracking();
            }
            
            riderApp_currentRider = null;
            riderApp_lastKnownPosition = null;
            document.getElementById('riderApp_rider-login').style.display = 'block';
            document.getElementById('riderApp_rider-dashboard').style.display = 'none';
            document.getElementById('riderApp_rider-login-form').reset();
            
            document.getElementById('riderApp_start-tracking-btn').style.display = 'block';
            document.getElementById('riderApp_stop-tracking-btn').style.display = 'none';
            document.getElementById('riderApp_tracking-status').innerHTML = '';
            main_showAlert('Rider logged out.', 'success');
        }

        async function riderApp_updateRiderStatus(status) {
            if (!riderApp_currentRider) {
                main_showAlert('Please login first.', 'error');
                return;
            }

            try {
                await indexedDBWrapper.put('riders', { ...riderApp_currentRider, status: status });
                riderApp_currentRider.status = status;
                riderApp_updateRiderStatusDisplay();
                main_showAlert(`Status updated to ${status}`, 'success');
                // Also trigger a refresh of admin riders data
                admin_loadRidersData();
            } catch (error) {
                console.error('Error updating status:', error);
                main_showAlert('Error updating status: ' + error.message, 'error');
            }
        }

        function riderApp_updateRiderStatusDisplay() {
            if (!riderApp_currentRider) return;

            const statusDot = document.getElementById('riderApp_rider-status-dot');
            const statusText = document.getElementById('riderApp_rider-status-text');
            
            statusDot.className = 'riderApp_status-dot ' + (riderApp_currentRider.status === 'online' ? 'online' : '');
            statusText.textContent = riderApp_currentRider.status.charAt(0).toUpperCase() + riderApp_currentRider.status.slice(1);
        }

        function riderApp_startLiveTracking() {
            if (!navigator.geolocation) {
                main_showAlert('Geolocation is not supported by this browser.', 'error');
                return;
            }

            if (!riderApp_currentRider) {
                main_showAlert('Please login first to start tracking.', 'error');
                return;
            }

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 5000
            };

            riderApp_watchId = navigator.geolocation.watchPosition(
                riderApp_handleLocationUpdate,
                riderApp_handleLocationError,
                options
            );

            document.getElementById('riderApp_start-tracking-btn').style.display = 'none';
            document.getElementById('riderApp_stop-tracking-btn').style.display = 'block';
            document.getElementById('riderApp_tracking-status').innerHTML = '<span style="color: #28a745;">🟢 Live tracking active</span>';
            
            main_showAlert('Live tracking started! Your location will be updated automatically.', 'success');
        }

        function riderApp_stopLiveTracking() {
            if (riderApp_watchId !== null) {
                navigator.geolocation.clearWatch(riderApp_watchId);
                riderApp_watchId = null;
            }

            document.getElementById('riderApp_start-tracking-btn').style.display = 'block';
            document.getElementById('riderApp_stop-tracking-btn').style.display = 'none';
            document.getElementById('riderApp_tracking-status').innerHTML = '<span style="color: #dc3545;">⚫ Tracking stopped</span>';
            
            main_showAlert('Live tracking stopped.', 'success');
        }

        async function riderApp_handleLocationUpdate(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            const timestamp = new Date(position.timestamp);

            if (riderApp_lastKnownPosition) {
                const distance = riderApp_calculateDistance(
                    riderApp_lastKnownPosition.latitude, riderApp_lastKnownPosition.longitude,
                    latitude, longitude
                );
                
                if (distance < 0.005 && Math.abs(accuracy - riderApp_lastKnownPosition.accuracy) < 5) {
                    return;
                }
            }

            try {
                await indexedDBWrapper.put('riders', {
                    ...riderApp_currentRider, // Preserve existing data
                    latitude: latitude,
                    longitude: longitude,
                    location_accuracy: accuracy,
                    updated_at: new Date().toISOString()
                });

                riderApp_currentRider.latitude = latitude;
                riderApp_currentRider.longitude = longitude;
                riderApp_currentRider.location_accuracy = accuracy;
                riderApp_lastKnownPosition = { latitude, longitude, accuracy };
                
                riderApp_updateLocationDisplay();
                
                document.getElementById('riderApp_tracking-status').innerHTML = 
                    `<span style="color: #28a745;">🟢 Updated at ${timestamp.toLocaleTimeString()}</span>`;
                
                admin_loadRidersData(); // Also trigger a refresh of admin riders data
            } catch (error) {
                console.error('Error updating location:', error);
                document.getElementById('riderApp_tracking-status').innerHTML = 
                    '<span style="color: #dc3545;">❌ Update failed</span>';
            }
        }

        function riderApp_handleLocationError(error) {
            console.error('Geolocation error:', error);
            let errorMessage = 'Location error: ';
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += 'Location permission denied';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += 'Location information unavailable';
                    break;
                case error.TIMEOUT:
                    errorMessage += 'Location request timed out';
                    break;
                default:
                    errorMessage += 'Unknown error';
                    break;
            }
            
            document.getElementById('riderApp_tracking-status').innerHTML = 
                `<span style="color: #dc3545;">❌ ${errorMessage}</span>`;
        }

        function riderApp_calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function riderApp_updateLocationDisplay() {
            const locationInfo = document.getElementById('riderApp_location-info');
            
            if (riderApp_currentRider && riderApp_currentRider.latitude && riderApp_currentRider.longitude) {
                locationInfo.innerHTML = `
                    <div class="riderApp_coordinates">
                        📍 ${riderApp_currentRider.latitude.toFixed(6)}, ${riderApp_currentRider.longitude.toFixed(6)}
                        ${riderApp_currentRider.location_accuracy ? `<br>Accuracy: ±${riderApp_currentRider.location_accuracy.toFixed(1)}m` : ''}
                    </div>
                `;
            } else {
                locationInfo.innerHTML = '<p>Location not available</p>';
            }
        }
        
        // --- Script from new rider.html ---
        // Supabase Configuration
        const NEW_SUPABASE_URL = 'https://doqfeaoerudohzoegxey.supabase.co';
        const NEW_SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRvcWZlYW9lcnVkb2h6b2VneGV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5ODQ5NTIsImV4cCI6MjA3MjU2MDk1Mn0.KvKVQaXnzITyFUkx4XjnrDLGxmvCBW4VVNZeSHH_m8Y';
        
        const newrider_supabase = window.supabase.createClient(NEW_SUPABASE_URL, NEW_SUPABASE_ANON_KEY);

        // Global variables
        let newrider_map = null;
        let newrider_markers = [];
        let newrider_riders = [];
        let newrider_currentRider = null;
        let newrider_watchId = null;
        let newrider_lastKnownPosition = null;

        // Page Navigation - Renamed to avoid conflict with main_showPage
        // The original `showPage` function in new rider.html is not directly used due to the main nav
        // Instead, main_showPage will activate the newrider sections and then call the newrider_loadRiders/newrider_initializeMap
        // directly.
        // function newrider_showPage(pageId) { /* ... original logic ... */ }

        // Initialize Map
        function newrider_initializeMap() {
            if (newrider_map) {
                newrider_map.remove();
            }
            
            // Center map on Karachi, Pakistan
            newrider_map = L.map('newrider_admin_map').setView([24.8607, 67.0011], 12);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(newrider_map);

            // Add restaurant marker
            L.marker([24.8607, 67.0011])
                .addTo(newrider_map)
                .bindPopup('<b>🍽️ Noman Restaurant</b><br>Main Location')
                .openPopup();
        }

        // Add New Rider
        async function newrider_addNewRider(event) {
            event.preventDefault();
            
            const riderId = document.getElementById('newrider_rider-id').value;
            const riderName = document.getElementById('newrider_rider-name').value;
            const riderPhone = document.getElementById('newrider_rider-phone').value;

            try {
                const { data, error } = await newrider_supabase
                    .from('riders')
                    .insert([
                        {
                            rider_id: riderId,
                            name: riderName,
                            phone: riderPhone,
                            status: 'offline'
                        }
                    ]);

                if (error) throw error;

                newrider_showAlert('Rider added successfully!', 'success');
                document.getElementById('newrider_add-rider-form').reset();
                newrider_loadRiders(); // Refresh the riders list
                
            } catch (error) {
                console.error('Error adding rider:', error);
                newrider_showAlert('Error adding rider: ' + error.message, 'error');
            }
        }

        // Clear All Riders
        async function newrider_clearAllRiders() {
            if (!confirm('Are you sure you want to delete ALL riders from the database? This action cannot be undone.')) {
                return;
            }

            try {
                const { error } = await newrider_supabase
                    .from('riders')
                    .delete()
                    .neq('id', '00000000-0000-0000-0000-000000000000'); // Delete all records

                if (error) throw error;

                newrider_showAlert('All riders have been cleared from the database!', 'success');
                newrider_loadRiders(); // Refresh the riders list
                
            } catch (error) {
                console.error('Error clearing riders:', error);
                newrider_showAlert('Error clearing riders: ' + error.message, 'error');
            }
        }

        // Load Riders
        async function newrider_loadRiders() {
            try {
                const { data, error } = await newrider_supabase
                    .from('riders')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                newrider_riders = data || [];
                newrider_updateRidersDisplay();
                newrider_updateStats();
                newrider_updateMapMarkers();
                newrider_updateLastUpdate();
                
            } catch (error) {
                console.error('Error loading riders:', error);
                document.getElementById('newrider_riders-list').innerHTML = 
                    '<div class="alert alert-error">Error loading riders: ' + error.message + '</div>';
            }
        }

        // Update Riders Display
        function newrider_updateRidersDisplay() {
            const ridersList = document.getElementById('newrider_riders-list');
            
            if (newrider_riders.length === 0) {
                ridersList.innerHTML = '<div class="loading">No riders found</div>';
                return;
            }

            ridersList.innerHTML = newrider_riders.map(rider => `
                <div class="rider-card ${rider.status}">
                    <div class="rider-header">
                        <div class="rider-info">
                            <h4>${rider.name}</h4>
                            <p>ID: ${rider.rider_id}</p>
                            <p>📞 ${rider.phone || 'N/A'}</p>
                        </div>
                        <span class="status-badge ${rider.status}">${rider.status}</span>
                    </div>
                    ${rider.latitude && rider.longitude ? `
                        <div class="coordinates">
                            📍 ${rider.latitude.toFixed(6)}, ${rider.longitude.toFixed(6)}
                            ${rider.location_accuracy ? `(±${rider.location_accuracy}m)` : ''}
                        </div>
                        <button class="btn btn-primary" onclick="newrider_locateRider(${rider.latitude}, ${rider.longitude}, '${rider.name}')">
                            Locate on Map
                        </button>
                    ` : '<p style="color: #666; font-style: italic;">No location data</p>'}
                </div>
            `).join('');
        }

        // Update Statistics
        function newrider_updateStats() {
            const total = newrider_riders.length;
            const online = newrider_riders.filter(r => r.status === 'online').length;
            const busy = newrider_riders.filter(r => r.status === 'busy').length;
            const offline = newrider_riders.filter(r => r.status === 'offline').length;

            document.getElementById('newrider_total-riders').textContent = total;
            document.getElementById('newrider_online-riders').textContent = online;
            document.getElementById('newrider_busy-riders').textContent = busy;
            document.getElementById('newrider_offline-riders').textContent = offline;
        }

        // Update Map Markers
        function newrider_updateMapMarkers() {
            // Clear existing markers
            newrider_markers.forEach(marker => marker.remove());
            newrider_markers = [];

            // Add rider markers
            newrider_riders.forEach(rider => {
                if (rider.latitude && rider.longitude) {
                    const icon = rider.status === 'online' ? '🟢' : 
                                 rider.status === 'busy' ? '🟡' : '🔴';
                    
                    const marker = L.marker([rider.latitude, rider.longitude])
                        .addTo(newrider_map)
                        .bindPopup(`
                            <b>${icon} ${rider.name}</b><br>
                            ID: ${rider.rider_id}<br>
                            Status: ${rider.status}<br>
                            Phone: ${rider.phone || 'N/A'}
                        `);
                    
                    newrider_markers.push(marker);
                }
            });
        }

        // Locate Rider on Map
        function newrider_locateRider(lat, lng, name) {
            newrider_map.setView([lat, lng], 16);
            L.popup()
                .setLatLng([lat, lng])
                .setContent(`<b>📍 ${name}</b><br>Current Location`)
                .openOn(newrider_map);
        }

        // Rider Login
        async function newrider_loginRider(event) {
            event.preventDefault();
            
            const riderId = document.getElementById('newrider_login-rider-id').value;
            const phone = document.getElementById('newrider_login-phone').value;

            try {
                const { data, error } = await newrider_supabase
                    .from('riders')
                    .select('*')
                    .eq('rider_id', riderId)
                    .eq('phone', phone)
                    .single();

                if (error) throw error;

                newrider_currentRider = data;
                document.getElementById('newrider_rider-name-display').textContent = data.name;
                document.getElementById('newrider_rider-login').style.display = 'none';
                document.getElementById('newrider_rider-dashboard').style.display = 'block';
                
                newrider_updateRiderStatusDisplay();
                newrider_updateLocationDisplay();
                
                newrider_showAlert('Rider logged in successfully!', 'success');
            } catch (error) {
                console.error('Error logging in:', error);
                newrider_showAlert('Invalid credentials. Please check your Rider ID and phone number.', 'error');
            }
        }

        // Logout Rider
        function newrider_logoutRider() {
            // Stop live tracking if active
            if (newrider_watchId !== null) {
                newrider_stopLiveTracking();
            }
            
            newrider_currentRider = null;
            newrider_lastKnownPosition = null;
            document.getElementById('newrider_rider-login').style.display = 'block';
            document.getElementById('newrider_rider-dashboard').style.display = 'none';
            document.getElementById('newrider_rider-login-form').reset();
            
            // Reset tracking UI
            document.getElementById('newrider_start-tracking-btn').style.display = 'block';
            document.getElementById('newrider_stop-tracking-btn').style.display = 'none';
            document.getElementById('newrider_tracking-status').innerHTML = '';
            newrider_showAlert('Rider logged out.', 'success');
        }

        // Update Rider Status
        async function newrider_updateRiderStatus(status) {
            if (!newrider_currentRider) return;

            try {
                const { error } = await newrider_supabase
                    .from('riders')
                    .update({ status: status })
                    .eq('rider_id', newrider_currentRider.rider_id);

                if (error) throw error;

                newrider_currentRider.status = status;
                newrider_updateRiderStatusDisplay();
                newrider_showAlert(`Status updated to ${status}`, 'success');
                
            } catch (error) {
                console.error('Error updating status:', error);
                newrider_showAlert('Error updating status: ' + error.message, 'error');
            }
        }

        // Update Rider Status Display
        function newrider_updateRiderStatusDisplay() {
            if (!newrider_currentRider) return;

            const statusDot = document.getElementById('newrider_rider-status-dot');
            const statusText = document.getElementById('newrider_rider-status-text');
            
            statusDot.className = 'status-dot ' + newrider_currentRider.status;
            statusText.textContent = newrider_currentRider.status.charAt(0).toUpperCase() + newrider_currentRider.status.slice(1);
        }

        // Start Live Tracking
        function newrider_startLiveTracking() {
            if (!navigator.geolocation) {
                newrider_showAlert('Geolocation is not supported by this browser.', 'error');
                return;
            }

            if (!newrider_currentRider) {
                newrider_showAlert('Please login first to start tracking.', 'error');
                return;
            }

            // Start watching position with high accuracy
            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 5000
            };

            newrider_watchId = navigator.geolocation.watchPosition(
                newrider_handleLocationUpdate,
                newrider_handleLocationError,
                options
            );

            // Update UI
            document.getElementById('newrider_start-tracking-btn').style.display = 'none';
            document.getElementById('newrider_stop-tracking-btn').style.display = 'block';
            document.getElementById('newrider_tracking-status').innerHTML = '<span style="color: #28a745;">🟢 Live tracking active</span>';
            
            newrider_showAlert('Live tracking started! Your location will be updated automatically.', 'success');
        }

        // Stop Live Tracking
        function newrider_stopLiveTracking() {
            if (newrider_watchId !== null) {
                navigator.geolocation.clearWatch(newrider_watchId);
                newrider_watchId = null;
            }

            // Update UI
            document.getElementById('newrider_start-tracking-btn').style.display = 'block';
            document.getElementById('newrider_stop-tracking-btn').style.display = 'none';
            document.getElementById('newrider_tracking-status').innerHTML = '<span style="color: #dc3545;">⚫ Tracking stopped</span>';
            
            newrider_showAlert('Live tracking stopped.', 'success');
        }

        // Handle Location Updates
        async function newrider_handleLocationUpdate(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            const timestamp = new Date(position.timestamp);

            // Check if location has changed significantly (more than 5 meters)
            if (newrider_lastKnownPosition) {
                const distance = newrider_calculateDistance(
                    newrider_lastKnownPosition.latitude, newrider_lastKnownPosition.longitude,
                    latitude, longitude
                );
                
                // Only update if moved more than 5 meters or accuracy improved significantly
                if (distance < 0.005 && Math.abs(accuracy - newrider_lastKnownPosition.accuracy) < 5) {
                    return;
                }
            }

            try {
                // Update rider location in database
                const { error } = await newrider_supabase
                    .from('riders')
                    .update({
                        latitude: latitude,
                        longitude: longitude,
                        location_accuracy: accuracy,
                        updated_at: new Date().toISOString()
                    })
                    .eq('rider_id', newrider_currentRider.rider_id);

                if (error) throw error;

                // Update local rider data
                newrider_currentRider.latitude = latitude;
                newrider_currentRider.longitude = longitude;
                newrider_currentRider.location_accuracy = accuracy;
                newrider_lastKnownPosition = { latitude, longitude, accuracy };
                
                // Update location display
                newrider_updateLocationDisplay();
                
                // Update tracking status
                document.getElementById('newrider_tracking-status').innerHTML = 
                    `<span style="color: #28a745;">🟢 Updated at ${timestamp.toLocaleTimeString()}</span>`;
                
            } catch (error) {
                console.error('Error updating location:', error);
                document.getElementById('newrider_tracking-status').innerHTML = 
                    '<span style="color: #dc3545;">❌ Update failed</span>';
            }
        }

        // Handle Location Errors
        function newrider_handleLocationError(error) {
            console.error('Geolocation error:', error);
            let errorMessage = 'Location error: ';
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += 'Location permission denied';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += 'Location information unavailable';
                    break;
                case error.TIMEOUT:
                    errorMessage += 'Location request timed out';
                    break;
                default:
                    errorMessage += 'Unknown error';
                    break;
            }
            
            document.getElementById('newrider_tracking-status').innerHTML = 
                `<span style="color: #dc3545;">❌ ${errorMessage}</span>`;
        }

        // Calculate distance between two coordinates (in kilometers)
        function newrider_calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Update Location Display
        function newrider_updateLocationDisplay() {
            const locationInfo = document.getElementById('newrider_location-info');
            
            if (newrider_currentRider && newrider_currentRider.latitude && newrider_currentRider.longitude) {
                locationInfo.innerHTML = `
                    <div class="coordinates">
                        📍 ${newrider_currentRider.latitude.toFixed(6)}, ${newrider_currentRider.longitude.toFixed(6)}
                        ${newrider_currentRider.location_accuracy ? `<br>Accuracy: ±${newrider_currentRider.location_accuracy.toFixed(1)}m` : ''}
                    </div>
                `;
            } else {
                locationInfo.innerHTML = '<p>Location not available</p>';
            }
        }

        // Refresh Admin Data
        function newrider_refreshAdminData() {
            newrider_loadRiders();
        }

        // Update Last Update Time
        function newrider_updateLastUpdate() {
            document.getElementById('newrider_last-update').textContent = new Date().toLocaleTimeString();
        }

        // Show Alert - Renamed to avoid conflict with main_showAlert
        function newrider_showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            // Insert alert at the top of the current page
            // This targets the newrider admin/rider container, not the main container.
            const currentPage = document.querySelector('.page-content.active .container');
            if (currentPage) {
                currentPage.insertBefore(alertDiv, currentPage.firstChild);
            } else {
                document.body.prepend(alertDiv);
            }
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Auto-refresh data every 30 seconds
        setInterval(() => {
            if (document.getElementById('newrider_admin-view-container').classList.contains('active')) {
                newrider_loadRiders();
            }
        }, 30000);
        // --- End Script from new rider.html ---

        // --- Initialization on DOM Load ---
        document.addEventListener('DOMContentLoaded', async function() {
            await indexedDBWrapper.open();
            main_showPage('customer'); // Default to customer view

            customer_init();
            admin_initializeApp(); // This will load initial admin data and setup its events/maps
            riderApp_init();
            // Initializing newrider_rider part (for direct access via main_showPage)
            // It uses the same init function as its original script's DOMContentLoaded.
            document.getElementById('newrider_add-rider-form').addEventListener('submit', newrider_addNewRider);
            document.getElementById('newrider_rider-login-form').addEventListener('submit', newrider_loginRider);
        });
    </script>
</body>
</html>